(this.webpackJsonp=this.webpackJsonp||[]).push([[2],{"+ExH":function(e,t,n){"use strict";n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return h}));var i=n("oRsZ"),a=n("IpiK"),r=n("d04y"),s=n("pRxM"),o=n("b3Jv"),l=n("4IGy"),d=n("xS/Y"),c=n("rdC+"),u=n("pP8i"),p=n("75G/");const m={Core:i.a.schema,MsgInfo:a.a.schema,Qos:r.a.schema,Reaction:s.a.schema,Search:o.a.schema,Storage:l.a.schema,Res:d.a.schema,SecureLocalstorage:c.a.schema,ZLog:u.a.schema,Media:p.a.schema},h={Core:i.a,MsgInfo:a.a,Qos:r.a,Reaction:s.a,Search:o.a,Storage:l.a,Res:d.a,SecureLocalstorage:c.a,ZLog:u.a,Media:p.a}},"1CsI":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("schema-version")},"1UUk":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));var i=n("jDHv"),a=n("AH6j"),r=n("pjo1");n("PmZf");class s extends a.b{constructor(...e){super(...e),this.session=void 0}createQueryBuilder(e){return i.ModuleContainer.resolve(r.a).createQueryBuilder(e)}}const o=Object(i.define)("database-manager")},"3wcW":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("VTBJ"),a=n("jDHv"),r=n("AH6j"),s=n("Mgpg"),o=n("UK4g"),l=n("DI/x"),d=n("PmZf"),c=n("1CsI");class u extends r.b{constructor(e,t,n,i){super(),this.fullname=e,this.partition=t,this.instance=n,this.allowMissingTable=i,this.version=void 0,this.logger=void 0,this.schemaVersionHistory=a.ModuleContainer.resolve(c.a);const r=a.ModuleContainer.resolve(s.ZLoggerFactory);this.logger=r.createZLogger(o.f,["migrate-executor"])}checkAbnormalSchemaMigration(e,t){const{isAbnormal:n,expectedVersion:i}=this.schemaVersionHistory.verifySchemaVersion(this.partition.type,this.fullname,e);n&&this.dispatchEvent(new d.f({fullname:this.fullname,expectedVersion:i,actualVersion:e,requestedVersion:t}))}async upgrade(e,t){if(this.checkAbnormalSchemaMigration(e,t),null!==t&&(this.logger.zsymb(3,"OujUhV",["Database: {} - Version: from {} to {} - Start","S8bu7r"],this.partition.database,e,t),e!==t))if(e<this.partition.milestoneVersion){0;const e=this.partition.tables.map((e=>({type:"create-table",params:{table:e}})));this.logger.zsymb(3,"-voW34",["Database: {} - Create ALL tables: {}","_FNZXO"],this.partition.database,e.map((({params:e})=>e.table.name))),await this._applyMigrations(e)}else{this.logger.zsymb(3,"_wblxp",["Database: {} - Create SOME tables","IZoZ1i"],this.partition.database);const n=this.partition.tables;for(const a of n){const n=a.getMigrationInfos(this.partition.type);if(0===Object.keys(n).length)continue;let r=e+1;for(;r<=t;){const e=n[r];if(e){const{scripts:t}=e,n=t.map((e=>{let t=e.params||{};return Object(i.a)(Object(i.a)({},e),{},{params:Object(i.a)({table:a},t)})}));this.logger.zsymb(3,"qWYMNu",["Database: {} - Current schema migrated version: {} - Table: {} - Action: {}","M74_kB"],this.partition.database,r,a.name,n.map((({type:e})=>e))),await this._applyMigrations(n)}r+=1}}}}async validate(){const e=this.partition.tables,t=await this._getTables(),n=e.filter((e=>-1===t.indexOf(e.tableName)));if(n.length>0){const e=n.map((e=>e.tableName));if(!this.allowMissingTable)throw new l.A(this.partition.database,e);await this.createMissingTable(n)}}async _applyMigrations(e){for(let t=0;t<e.length;t++){const n=e[t];switch(n.type){case"create-table":{const e=n.params.table,t={partition:this.partition.name,table:e.name};0,await this._createTable(e).catch((e=>{throw this.logger.zsymb(18,"vRMMnr","create table error",t,e.message),e}));break}case"create-index":{const{table:e,indexName:t}=n.params,i={partition:this.partition.name,table:e.name,index:t};0,await this._createIndex(e,t).catch((e=>{throw this.logger.zsymb(18,"KAtfRM","create index error",i,e.message),e}));break}case"add-column":{const{table:e,columns:t}=n.params,i={partition:this.partition.name,table:e.name,columns:t};0,await this._addColumns(e,t).catch((e=>{throw this.logger.zsymb(18,"hUbvAc","add columns error",i,e.message),e}));break}default:throw new l.H(`Unhandled '${n.type}' migration script.`)}}}}},"45ei":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"e",(function(){return d}));var i=n("AH6j");let a=function(e){return e.Start="Start",e.InitServices="InitServices",e.ServicesReady="ServicesReady",e.Exit="Exit",e.BeforeUnload="BeforeUnload",e.Idle="Idle",e.Active="Active",e.FirstIdle="FirstIdle",e.Authenticating="Authenticating",e.Authenticated="Authenticated",e.LogOut="LogOut",e}({});class r extends i.a{constructor(e){super(a.InitServices),this.app=e}}class s extends i.a{constructor(e,t){super(e),this.type=e,this._session=void 0,this.getSession=()=>this._session,this._session=t}}class o extends s{constructor(e){super(a.Authenticating,e)}}class l extends s{constructor(e){super(a.Authenticated,e)}}class d extends i.a{constructor(e){super(a.LogOut),this.shouldClearData=e}}},"4IGy":function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv"),l=n("mpOJ"),d=n("yi2h");const c={CocosRes:new s.d({tableName:"cocos-res",name:"CocosRes",fields:{path:{name:"path",type:a.h.string},data:Object(d.a)({name:"data"},l.a.ArrayBuffer)},indices:{primary:{name:"primary",fields:[{type:"raw",field:"path"}],unique:!0}}}),FriendBlocked:new s.d({tableName:"friend-blocked",name:"FriendBlocked",fields:{key:{name:"key",type:a.h.string},val:{name:"val",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}}),InfoCache:new s.d({tableName:"info-cache",name:"InfoCache",fields:{key:{name:"key",type:a.h.string},val:{name:"val",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}}),RetryCache:new s.d({tableName:"retry-cache",name:"RetryCache",fields:{key:{name:"key",type:a.h.string},val:{name:"val",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}}),StChecksum:new s.d({tableName:"db-stchecksum",name:"StChecksum",fields:{checksum:{name:"checksum",type:a.h.string},url:{name:"url",type:a.h.string},size:{name:"size",type:a.h.integer},isGroup:{name:"isGroup",type:a.h.boolean},ts:{name:"ts",type:a.h.integer},zname:{name:"zname",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"checksum"}],unique:!0}}})},u={name:"Storage",session:!1},p={partitionNamingStrategy:[r.a.const("Storage")],partitionsMap:Object(o.a)(c)},m={partitionNamingStrategy:[r.a.const("zlocalstorage")],partitionsMap:Object(o.a)(c)},h=Object(i.a)(Object(i.a)(Object(i.a)({},u),p),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_PARTIAL}),y=Object(i.a)(Object(i.a)(Object(i.a)({},u),m),{},{version:5,milestoneVersion:5,type:a.a.IDB});let g=null,f=null;t.a={baseConfig:u,schema:c,get useSqlite(){return null===g&&(g=new s.a(h)),g},get useIdb(){return null===f&&(f=new s.a(y)),f}}},"4W2c":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("DI/x"),a=n("YZti");class r{constructor(){}}class s extends r{constructor(e){super(),this.secureFields=e,this.cipcherKey=""}init(e){this.cipcherKey=e}toDB(e){if(""===this.cipcherKey)throw new i.j("Cipher key is unavailable!");for(let t=0;t<this.secureFields.length;t++){const n=this.secureFields[t];e[n]&&(e[n]=a.a.encrypt(JSON.stringify(e[n]),this.cipcherKey))}}fromDB(e){if(e){if(""===this.cipcherKey)throw new i.j("Cipher key is unavailable!");for(let n=0;n<this.secureFields.length;n++){const i=this.secureFields[n];if("string"==typeof e[i])try{e[i]=JSON.parse(a.a.decrypt(e[i],this.cipcherKey))}catch(t){}}}}}},"6Cx8":function(e,t,n){},"6Sr9":function(e,t,n){"use strict";n.d(t,"h",(function(){return p})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return h})),n.d(t,"e",(function(){return y})),n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return f})),n.d(t,"f",(function(){return b})),n.d(t,"g",(function(){return I}));var i=n("jDHv"),a=n("45ei");const r=[],s=[],o=[],l=[],d=[],c=[],u=[];function p(){return function(e){r.push(e)}}function m(){return function(e){s.push(e)}}function h(){return function(e){o.push(e)}}function y(){return function(e){l.push(e)}}function g(){return function(e){d.push(e)}}function f(){return function(e){c.push(e)}}function b(){return function(e){u.push(e)}}function I(e){e.addEventListenerOnce(a.a.InitServices,(e=>{r.forEach((t=>{try{i.ModuleContainer.resolveToken(t).onStart(e)}catch(n){}}))})),e.addEventListenerOnce(a.a.Authenticating,(e=>{s.forEach((t=>i.ModuleContainer.resolveToken(t).onAuthenticating(e)))})),e.addEventListenerOnce(a.a.Authenticated,(e=>{o.forEach((t=>i.ModuleContainer.resolveToken(t).onAuthenticated(e)))})),e.addEventListenerOnce(a.a.Start,(e=>{d.forEach((t=>{try{i.ModuleContainer.resolveToken(t).onApplicationStart(e)}catch(n){}}))})),e.addEventListenerOnce(a.a.ServicesReady,(e=>{c.forEach((t=>i.ModuleContainer.resolveToken(t).onApplicationReady(e)))})),e.addEventListenerOnce(a.a.Exit,(()=>{l.forEach((e=>i.ModuleContainer.resolveToken(e).onDispose()))})),e.addEventListenerOnce(a.a.LogOut,(()=>{u.forEach((e=>i.ModuleContainer.resolveToken(e).onSessionExpired()))}))}},"75G/":function(e,t,n){"use strict";var i=n("VTBJ"),a=n("teaq"),r=n("xI/L"),s=n("YEoC"),o=n("C9Dv"),l=n("wH4e"),d=n("4W2c");const c=new a.d({tableName:"image",name:"Image",fields:{mediaId:{name:"mediaId",type:l.ValidDataType.string},convId:{name:"convId",type:l.ValidDataType.string},cliMsgId:{name:"cliMsgId",type:l.ValidDataType.string},fromUid:{name:"fromUid",type:l.ValidDataType.string},content:{name:"content",type:l.ValidDataType.json},type:{name:"type",type:l.ValidDataType.integer},src:{name:"src",type:l.ValidDataType.string},sendDttm:{name:"sendDttm",type:l.ValidDataType.integer},ttl:{name:"ttl",type:l.ValidDataType.integer},localPath:{name:"localPath",type:l.ValidDataType.string},previewThumb:{name:"previewThumb",type:l.ValidDataType.string},modifiedTime:{name:"modifiedTime",type:l.ValidDataType.integer},metadata:{name:"metadata",type:l.ValidDataType.json}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"mediaId"}],unique:!0},convId_sendDttm_cliMsgId:{name:"convId_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!1},convId_fromUid_sendDttm_cliMsgId:{name:"convId_fromUid_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"fromUid"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!0}},transforms:[new d.a(["content","localPath"])]});c.setAdapterSpecificConfigs(l.AdapterType.IDB,{}),c.setAdapterSpecificConfigs(l.AdapterType.SQLite,{});const u=new a.d({tableName:"file",name:"File",fields:{mediaId:{name:"mediaId",type:l.ValidDataType.string},convId:{name:"convId",type:l.ValidDataType.string},cliMsgId:{name:"cliMsgId",type:l.ValidDataType.string},fromUid:{name:"fromUid",type:l.ValidDataType.string},content:{name:"content",type:l.ValidDataType.json},type:{name:"type",type:l.ValidDataType.integer},src:{name:"src",type:l.ValidDataType.string},extType:{name:"extType",type:l.ValidDataType.string},sendDttm:{name:"sendDttm",type:l.ValidDataType.integer},ttl:{name:"ttl",type:l.ValidDataType.integer},modifiedTime:{name:"modifiedTime",type:l.ValidDataType.integer},localPath:{name:"localPath",type:l.ValidDataType.string},folderPath:{name:"folderPath",type:l.ValidDataType.string},thumbMetadata:{name:"thumbMetadata",type:l.ValidDataType.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"mediaId"}],unique:!0},convId_sendDttm_cliMsgId:{name:"convId_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!1},convId_fromUid_sendDttm_cliMsgId:{name:"convId_fromUid_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"fromUid"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!0},convId_extType_sendDttm_cliMsgId:{name:"convId_extType_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"extType"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!1}},transforms:[new d.a(["content","localPath","folderPath"])]});u.setAdapterSpecificConfigs(l.AdapterType.IDB,{}),u.setAdapterSpecificConfigs(l.AdapterType.SQLite,{});const p=new a.d({tableName:"link",name:"Link",fields:{mediaId:{name:"mediaId",type:l.ValidDataType.string},convId:{name:"convId",type:l.ValidDataType.string},cliMsgId:{name:"cliMsgId",type:l.ValidDataType.string},fromUid:{name:"fromUid",type:l.ValidDataType.string},content:{name:"content",type:l.ValidDataType.json},type:{name:"type",type:l.ValidDataType.integer},src:{name:"src",type:l.ValidDataType.string},sendDttm:{name:"sendDttm",type:l.ValidDataType.integer},ttl:{name:"ttl",type:l.ValidDataType.integer},modifiedTime:{name:"modifiedTime",type:l.ValidDataType.integer},parsedInfo:{name:"parsedInfo",type:l.ValidDataType.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"mediaId"}],unique:!0},convId_sendDttm_cliMsgId:{name:"convId_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!1},convId_fromUid_sendDttm_cliMsgId:{name:"convId_fromUid_sendDttm_cliMsgId",fields:[{type:"raw",field:"convId"},{type:"raw",field:"fromUid"},{type:"raw",field:"sendDttm"},{type:"raw",field:"cliMsgId"}],unique:!0}},transforms:[new d.a(["content","parsedInfo"])]});p.setAdapterSpecificConfigs(l.AdapterType.IDB,{}),p.setAdapterSpecificConfigs(l.AdapterType.SQLite,{});const m=new a.d({tableName:"utils_media",name:"UtilsMedia",fields:{id:{name:"id",type:l.ValidDataType.string},convId:{name:"convId",type:l.ValidDataType.string},mediaType:{name:"mediaType",type:l.ValidDataType.string},senderIds:{name:"senderIds",type:l.ValidDataType.json},fileTypes:{name:"fileTypes",type:l.ValidDataType.json}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}});m.setAdapterSpecificConfigs(l.AdapterType.IDB,{}),m.setAdapterSpecificConfigs(l.AdapterType.SQLite,{});const h={Image:c,File:u,Link:p,UtilsMedia:m},y={name:"Media",session:!0},g={partitionNamingStrategy:[r.a.byUser(),r.a.const("Media")],partitionsMap:Object(o.a)(h)},f={partitionNamingStrategy:[r.a.const("media"),r.a.byUser()],partitionsMap:Object(o.a)(h)},b=Object(i.a)(Object(i.a)(Object(i.a)({},y),g),{},{version:1,milestoneVersion:1,type:s.a.SQLite,corruptionImpact:s.b.IMPACT_FULL}),I=Object(i.a)(Object(i.a)(Object(i.a)({},y),f),{},{version:1,milestoneVersion:1,type:s.a.IDB});let v=null,C=null;t.a={baseConfig:y,schema:h,get useSqlite(){return null===v&&(v=new a.a(b)),v},get useIdb(){return null===C&&(C=new a.a(I)),C}}},"7FSS":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=globalThis.zconsole||globalThis.console},"7xKq":function(e,t){},"8/YW":function(e,t,n){"use strict";var i=n("45ei");n.d(t,"b",(function(){return i.a})),n.d(t,"c",(function(){return i.d}));var a=n("Jcee");n.d(t,"a",(function(){return a.a}));var r=n("6Sr9");n.d(t,"d",(function(){return r.a})),n.d(t,"e",(function(){return r.b})),n.d(t,"f",(function(){return r.c})),n.d(t,"g",(function(){return r.d})),n.d(t,"h",(function(){return r.e})),n.d(t,"i",(function(){return r.f})),n.d(t,"j",(function(){return r.h}))},AH6j:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));class i{constructor(e){this.type=e}}class a{constructor(){this.events=void 0,this.events=new Map}getNumberListener(){return this.events.size}addEventListener(e,t,n){const i=e.toString();let a=this.events.get(i);a||(a=[],this.events.set(i,a));const r=()=>this.removeEventListener(e,t);if(!0===(null==n?void 0:n.once)){const e=t;t=t=>(r(),e(t))}return a.push(t),r}addEventListenerOnce(e,t){return this.addEventListener(e,t,{once:!0})}removeEventListener(e,t){const n=e.toString(),i=this.events.get(n);if(!i)return;this.events.set(n,i.filter((e=>e!==t)))}removeAllEventListener(){this.events.clear()}dispatchEvent(e){let t=this.events.get(e.type);if(t&&0!==t.length){t=t.slice();for(let n=0;n<t.length;n++){const i=t[n];i&&i(e)}}}}},Abbu:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("YEoC");let a;var r;(r=a||(a={})).isBeginTransaction=function(e){return e.type===i.e.BeginTransaction},r.isCommitTransaction=function(e){return e.type===i.e.CommitTransaction},r.isInsertQuery=function(e){return e.type===i.e.Insert},r.isUpdateQuery=function(e){return e.type===i.e.Update},r.isCloseDBQuery=function(e){return e.type===i.e.CloseDB},r.isDeleteDBQuery=function(e){return e.type===i.e.DeleteDB},r.isCloseAllDBsQuery=function(e){return e.type===i.e.CloseAllDBs},r.isDeleteAllDBsQuery=function(e){return e.type===i.e.DeleteAllDBs},r.isInTransaction=function(e){return!!e.transaction},r.isValid=function(e){return!0},r.isPartitionlessQuery=function(e){return e.type===i.e.BeginTransaction||e.type===i.e.CommitTransaction}},C9Dv:function(e,t,n){"use strict";function i(e){return{default:{tables:Object.values(e)}}}n.d(t,"a",(function(){return i}))},"DI/x":function(e,t,n){"use strict";n.d(t,"q",(function(){return a})),n.d(t,"m",(function(){return r})),n.d(t,"n",(function(){return s})),n.d(t,"k",(function(){return o})),n.d(t,"r",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"i",(function(){return c})),n.d(t,"C",(function(){return u})),n.d(t,"I",(function(){return p})),n.d(t,"B",(function(){return m})),n.d(t,"t",(function(){return h})),n.d(t,"u",(function(){return y})),n.d(t,"z",(function(){return g})),n.d(t,"x",(function(){return f})),n.d(t,"w",(function(){return b})),n.d(t,"s",(function(){return I})),n.d(t,"y",(function(){return v})),n.d(t,"v",(function(){return C})),n.d(t,"a",(function(){return w})),n.d(t,"g",(function(){return T})),n.d(t,"o",(function(){return S})),n.d(t,"f",(function(){return _})),n.d(t,"j",(function(){return M})),n.d(t,"h",(function(){return N})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return A})),n.d(t,"p",(function(){return E})),n.d(t,"l",(function(){return j})),n.d(t,"D",(function(){return O})),n.d(t,"E",(function(){return x})),n.d(t,"G",(function(){return k})),n.d(t,"H",(function(){return U})),n.d(t,"A",(function(){return F})),n.d(t,"b",(function(){return B})),n.d(t,"F",(function(){return L}));var i=n("YEoC");const a=206,r=301,s=306,o=307,l=502;class d extends Error{constructor(e,t,n=[]){super(t),this._code=void 0,this.adapterType=null,this.qosParams=void 0,this.qosParams=[t,...n],this._code=e}get code(){return this._code}get codeString(){return`0x13${this._code}`}setStack(e){const t=`${this.name}: ${this.message}`;this.stack=t+(e||"")}setAdaperType(e){this.adapterType=e}}class c extends d{constructor(e,t){super(102,e,t),this.name="DBUnknownError"}}class u extends d{constructor(e){super(103,"",e),this.name="QueryTimeout"}}class p extends d{constructor(e,t,n){super(104,`'${e}' - ${t}`,n),this.name="WrongUseOfMethod"}}class m extends d{constructor(e,t){super(105,`'${e}' hasn't been supported yet!`,t),this.name="NonSupportedFeature"}}class h extends d{constructor(e,t){super(201,`Missing config for '${e}' database`,t),this.name="MissingDatabaseConfig"}}class y extends d{constructor(e,t){super(202,`Missing schema for '${e}' database`,t),this.name="MissingDatabaseSchema"}}class g extends d{constructor(e,t){super(203,`Missing config for '${e}' table`,t),this.name="MissingTableConfig"}}class f extends d{constructor(e,t,n){let i=`Missing partition config for '${e}' table`;if(t){const{userId:e}=t;i+=` - userId: ${e}`}super(204,i,n),this.name="MissingPartitionConfig"}}class b extends d{constructor(e,t){super(205,`Missing config for'${e}' index!`,t),this.name="MissingIndexConfig"}}class I extends d{constructor(e,t){super(210,`Missing config 'corruptionImpact' for '${e}'!`,t),this.name="MissingCorruptionImpactConfigError"}}class v extends d{constructor(e,t){super(a,e,t),this.name="MissingPartitionKey"}}class C extends d{constructor(e,t){super(207,`Missing field config for '${e}' field!`,t),this.name="MissingFieldConfig"}}class w extends d{constructor(e,t){super(208,t,[e]),this.name="CreateAdapterError"}}class T extends d{constructor(e,t){super(209,e,t),this.name="DBSettingsError"}}class S extends d{constructor(e,t){super(r,e,t),this.name="InvalidQueryParams"}}class _ extends d{constructor(e,t){super(302,e,t),this.name="DBExecutionError"}}class M extends d{constructor(e,t){super(303,e,t),this.name="DataTransformError"}}class N extends d{constructor(e,t){super(304,e,t),this.name="DBTransactionError"}}class D extends d{constructor(e,t){super(305,e,t),this.name="DBConnectionError"}}class A extends d{constructor(e,t){super(309,e,t),this.name="DBCorruptError",this.adapterType=i.a.IDB}}class E extends d{constructor(e,t){const{fullname:n,currentVersion:i,requestedVersion:a}=e;super(s,`An attempt was made to open a database (${n}) using a lower version (${a}) than the existing version (${i}).`,t),this.data=e,this.name="InvalidVersionError"}}class j extends d{constructor(e,t){super(o,e,t),this.name="FaildToOpenDBConnectionError"}}class O extends d{constructor(e,t){super(401,e,t),this.name="SQLiteAdapterError"}}class x extends d{constructor(e,t){super(402,e,t),this.name="SQLiteConnectionError"}}class k extends d{constructor(e,t){super(403,e,t),this.name="SQLiteStatementError"}}class U extends d{constructor(e,t){super(501,e,t),this.name="SchemaMigrationError"}}class F extends d{constructor(e,t,n){const i=`Found missing table(s): ${JSON.stringify(t)}. But current adapter cannot create table without increasing the database version.`;super(l,i,n),this.database=e,this.missingTables=t,this.name="MissingTableError"}}class B extends d{constructor(e,t,n){super(n,e),this.name=void 0,this.adapterType=i.a.IDB,this.name=t}}class L extends d{constructor(e,t,n){super(t,e.replace(`${n}: `,"")),this.name=void 0,this.adapterType=i.a.SQLite,this.name=n}}},IpiK:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv");const l=new s.d({tableName:"ConvMsgStatus",name:"ConvMsgStatus",fields:{userId:{name:"userId",type:a.h.string},data:{name:"data",type:a.h.json}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),d=new s.d({tableName:"MsgInfo",name:"MsgInfo",fields:{msgId:{name:"msgId",type:a.h.integer},seenUids:{name:"seenUids",type:a.h.json},deliveredUids:{name:"deliveredUids",type:a.h.json},extraJson:{name:"extraJson",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0}}});var c=n("4W2c");const u=new s.d({tableName:"MsgUrgency",name:"MsgUrgency",fields:{sendDttm:{name:"sendDttm",type:a.h.string},cliMsgId:{name:"cliMsgId",type:a.h.string},fromUid:{name:"fromUid",type:a.h.string},mentions:{name:"mentions",type:a.h.json,nullable:!0},message:{name:"message",type:a.h.json},msgId:{name:"msgId",type:a.h.string},msgType:{name:"msgType",type:a.h.integer},toUid:{name:"toUid",type:a.h.string},src:{name:"src",type:a.h.integer,nullable:!0},quote:{name:"quote",type:a.h.json,nullable:!0},properties:{name:"properties",type:a.h.json,nullable:!0},urgency:{name:"urgency",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},sendDttm:{name:"sendDttm",fields:[{type:"raw",field:"sendDttm"}],unique:!1},conv_msgId:{name:"conv_msgId",fields:[{type:"raw",field:"toUid"},{type:"raw",field:"msgId"}],unique:!0}},transforms:[new c.a(["message"])]});u.setAdapterSpecificConfigs(a.a.IDB,{}),u.setAdapterSpecificConfigs(a.a.SQLite,{});const p=new s.d({tableName:"Quotes",name:"Quotes",fields:{msgId:{name:"msgId",type:a.h.integer},convId:{name:"convId",type:a.h.string},sendDttm:{name:"sendDttm",type:a.h.integer},parentId:{name:"parentId",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},convId_sendDttm:{name:"convId_sendDttm",fields:[{type:"raw",field:"convId"},{type:"raw",field:"sendDttm"}],unique:!1}}}),m=new s.d({tableName:"ThreadHis",name:"ThreadHis",fields:{msgId:{name:"msgId",type:a.h.integer},toUid:{name:"toUid",type:a.h.string},isGroup:{name:"isGroup",type:a.h.boolean},childs:{name:"childs",type:a.h.json}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0}}}),h=new s.d({tableName:"ThreadMsg",name:"ThreadMsg",fields:{ownerId:{name:"ownerId",type:a.h.string,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.integer},globalMsgId:{name:"globalMsgId",type:a.h.integer},cliMsgType:{name:"cliMsgType",type:a.h.integer},ts:{name:"ts",type:a.h.integer},msg:{name:"msg",type:a.h.string},attach:{name:"attach",type:a.h.string},fromD:{name:"fromD",type:a.h.string},convId:{name:"convId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"globalMsgId"}],unique:!0}},transforms:[new c.a(["msg","attach"])]});h.setAdapterSpecificConfigs(a.a.IDB,{}),h.setAdapterSpecificConfigs(a.a.SQLite,{});const y=new s.d({tableName:"TTLItem",name:"TTLItem",fields:{cliMsgId:{name:"cliMsgId",type:a.h.string},fromUid:{name:"fromUid",type:a.h.string},toUid:{name:"toUid",type:a.h.string},msgId:{name:"msgId",type:a.h.string},beginTime:{name:"beginTime",type:a.h.integer},sendDttm:{name:"sendDttm",type:a.h.string,nullable:!0},serverTime:{name:"serverTime",type:a.h.string},ttl:{name:"ttl",type:a.h.integer},ttlType:{name:"ttlType",type:a.h.string},expireOn:{name:"expireOn",type:a.h.integer},mediaType:{name:"mediaType",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"},{type:"raw",field:"ttlType"}],unique:!0},expireOn_toUid_pk:{name:"expireOn_toUid_pk",fields:[{type:"raw",field:"expireOn"},{type:"raw",field:"toUid"},{type:"raw",field:"msgId"},{type:"raw",field:"ttlType"}],unique:!0},toUid_serverTime_pk:{name:"toUid_serverTime_pk",fields:[{type:"raw",field:"toUid"},{type:"raw",field:"serverTime"},{type:"raw",field:"msgId"},{type:"raw",field:"ttlType"}],unique:!0}}}),g={ConvMsgStatus:l,MsgInfo:d,MsgUrgency:u,Quotes:p,ThreadMsg:h,ThreadHis:m,UnreadInfo:new s.d({tableName:"unreadInfo",name:"UnreadInfo",fields:{mId:{name:"mId",type:a.h.integer},userId:{name:"userId",type:a.h.string},timestamp:{name:"timestamp",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),TTLItem:y},f={name:"MsgInfo",session:!0},b={partitionNamingStrategy:[r.a.byUser(),r.a.const("MsgInfo")],partitionsMap:Object(o.a)(g)},I={partitionNamingStrategy:[r.a.const("msginfo"),r.a.byUser()],partitionsMap:Object(o.a)(g)},v=Object(i.a)(Object(i.a)(Object(i.a)({},f),b),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_FULL}),C=Object(i.a)(Object(i.a)(Object(i.a)({},f),I),{},{version:6,milestoneVersion:6,type:a.a.IDB});let w=null,T=null;t.a={baseConfig:f,schema:g,get useSqlite(){return null===w&&(w=new s.a(v)),w},get useIdb(){return null===T&&(T=new s.a(C)),T}}},Jcee:function(e,t,n){"use strict";n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return y}));var i=n("jDHv"),a=n("AH6j"),r=n("45ei");class s{constructor(){this.disposables=void 0,this.disposables=[]}add(e){"function"==typeof e?this.disposables.push(e):this.disposables.push(e.dispose)}remove(e){let t=this.disposables.findIndex((t=>t===e));this.disposables.slice(t,1)}dispose(){for(const e of this.disposables)e()}}var o=n("6Sr9"),l=n("8/YW"),d=n("WOPK");const c=new Map;class u{constructor(){this.id=void 0,this.id=Object(d.a)()}revoke(){c.delete(this.id)}}class p extends u{constructor(){if(super(),this._status=void 0,p.instance)return p.instance;p.instance=this}get status(){return this._status}create(){this._status="create",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.create)||void 0===n?void 0:n.call(t)}))}start(){this._status="start",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.start)||void 0===n?void 0:n.call(t)}))}running(){this._status="running",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.running)||void 0===n?void 0:n.call(t)}))}pause(){this._status="pause",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.pause)||void 0===n?void 0:n.call(t)}))}resume(){this._status="resume",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.resume)||void 0===n?void 0:n.call(t)}))}restart(){this._status="restart",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.restart)||void 0===n?void 0:n.call(t)}))}stop(){this._status="stop",c.forEach((e=>{var t,n;return null===(t=i.ModuleContainer.resolveToken(e))||void 0===t||null===(n=t.stop)||void 0===n?void 0:n.call(t)}))}}p.instance=void 0;const m=new p;class h extends a.b{constructor(e,t,n){super(),this.name=e,this.config=t,this.disposables=void 0,this.currentSession=null,this.logger=void 0,this.onApplicationStarted=e=>{this.dispatchEvent(e)},this.onInitService=e=>{this.dispatchEvent(e)},this.onServiceReady=e=>{this.dispatchEvent(e)},this.onApplicationExit=e=>{this.dispatchEvent(e)},this.onBeforeUnload=()=>{this.dispatchEvent(new Event(r.a.BeforeUnload))},this.onApplicationFirstIdle=e=>{this.dispatchEvent(e)},this.onApplicationIdle=e=>{this.logger.zsymb(12,"WRmaT2","idle"),this.dispatchEvent(e)},this.onApplicationActive=e=>{this.logger.zsymb(12,"-AT93x","active"),this.dispatchEvent(e)},this.logger=n.createZLogger("common",["application"]),this.disposables=new s,m.create()}async start(){this.logger.zsymb(0,"qUfb3c","starting"),this.listenInternalEvents(),Object(o.g)(this),this.onApplicationStarted(new Event(r.a.Start)),m.start()}async init(){this.logger.zsymb(3,"ay0dI-",["initializing services...","KHsdN3"]),this.onInitService(new l.c(this)),window.addEventListener("beforeunload",(()=>{this.onBeforeUnload()}))}async ready(){this.logger.zsymb(3,"RdnYIS",["application ready","C4izXE"]),this.onServiceReady(new Event(r.a.ServicesReady)),m.running()}async exit(){this.logger.zsymb(3,"6rruWv",["exiting","GL6L_n"]),this.onApplicationStarted(new Event(r.a.Exit)),setTimeout((()=>{this.disposables.dispose()})),m.stop()}authenticating(e){this.logger.zsymb(0,"VJQcFg",(()=>["authenticating",{id:e.userId}])),this.currentSession=e,this.dispatchEvent(new r.c(this.currentSession))}authenticate(e){this.logger.zsymb(0,"3_tKgl",(()=>["authenticate",{id:e.userId}])),this.currentSession=e,this.dispatchEvent(new r.c(this.currentSession)),this.dispatchEvent(new r.b(this.currentSession))}logOut(e){this.dispatchEvent(new r.e(e))}getSession(){return this.currentSession}setStateToIdle(){this.onApplicationIdle(new Event(r.a.Idle))}setStateToActive(){this.onApplicationActive(new Event(r.a.Active))}listenInternalEvents(){this.addEventListenerOnce(r.a.Idle,(()=>this.onApplicationFirstIdle(new Event(r.a.FirstIdle))))}}const y=Object(i.define)("application")},LzQZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("database-transaction-manager")},MRjZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var i=n("VTBJ"),a=n("YZti"),r=n("Abbu");function s(e,t){var n;const s=Object(i.a)({method:a.c.getTypeName(e.type),database:e.database,table:r.a.isBeginTransaction(e)?e.params.tables.join(","):e.table,step:e.meta.step,partition:e.meta.partitionKey,trans:e.transaction,adapterType:(null===(n=e.meta.databaseConfig)||void 0===n?void 0:n.typeName)||"unknown"},null!=t?t:{});return o=s,Object.entries(o).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join(",");var o}const o=e=>e&&e.stack&&e.message;function l(e,t=!1){const n=e&&o(e)?`${e.name}: ${e.message}`:String(e);return t?`${n}\ntrace: ${e.stack}`:n}},MWu7:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("xM06");let a;var r;(r=a||(a={})).isCorruptError=function(e){const{message:t}=e;return!!i.z.some((e=>t.includes(e)))},r.isOutOfMemError=function(e){if(!(e instanceof Error))return!1;const{message:t}=e;return t.includes("malformed")},r.isRawSQLiteException=function(e){return e instanceof Error&&void 0!==e.errno&&void 0!==e.code},r.isSerializedSQLiteException=function(e){return"object"==typeof e&&void 0!==e.errno&&void 0!==e.code},r.serializeSQLiteException=function(e){if(!a.isRawSQLiteException(e))throw new Error("Can't serialize a non SQLite exception error");return{errno:e.errno,code:e.code,message:e.message}}},Mgpg:function(e,t,n){"use strict";n.r(t);var i=n("XB6V");n.d(t,"ZLoggerFactory",(function(){return i.a}));var a=n("7xKq");n.d(t,"ZLogger",(function(){return a.ZLogger}));var r=n("7FSS");n.d(t,"dangerouslyLogConsole",(function(){return r.a}));var s=n("OMsT");n.d(t,"ZLogCollector",(function(){return s.a}));var o=n("jGDt");n.d(t,"ZLogSession",(function(){return o.a}))},OMsT:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("log-collector")},PhBv:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var i=n("jDHv"),a=n("AH6j");n("PmZf");class r extends a.b{}const s=Object(i.define)("database-query-planner")},PmZf:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"j",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"h",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"f",(function(){return m})),n.d(t,"k",(function(){return h}));var i=n("AH6j");let a=function(e){return e.Close="close",e.SessionChange="session-change",e.MigrateProgress="migrate-progress",e.MigratePhaseChange="migrate-phase-change",e.MigrateDone="migrate-done",e.TimeConsumingQuery="time-consuming-query",e.SuccessOpenDB="success-open-db",e.ConnectionClosedAbnormally="connection-close-abnormally",e.SchemaMigratedAbnormally="schema-migrate-abnormally",e.TransactionEnd="transaction-end",e.QueryExec="query-exe",e.QueryError="query-error",e.UnexpectedError="unexpected-error",e.LongOpenDB="long-open-db",e.Warning="warning",e}({});i.a;class r extends i.a{constructor(e){super(a.SessionChange),this.session=e}}i.a;i.a;i.a;i.a;class s extends i.a{constructor(e){super(a.QueryExec),this.data=e}}class o extends i.a{constructor(e){super(a.QueryError),this.error=e}}class l extends i.a{constructor(e){super(a.UnexpectedError),this.error=e}}class d extends i.a{constructor(e,t){super(a.TimeConsumingQuery),this.logInfo=e,this.totalTime=t}}class c extends i.a{constructor(e){super(a.SuccessOpenDB),this.data=e}}class u extends i.a{constructor(e){super(a.ConnectionClosedAbnormally),this.database=e}}class p extends i.a{constructor(e){super(a.LongOpenDB),this.data=e}}class m extends i.a{constructor(e){super(a.SchemaMigratedAbnormally),this.data=e}}class h extends i.a{constructor(e){super(a.Warning),this.data=e}}},SWKE:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("jDHv"),a=n("Mgpg"),r=n("fsN4");class s{constructor(){this.logger=void 0;const e=i.ModuleContainer.resolve(a.ZLoggerFactory);this.logger=e.createZLogger("localstorage",["cleaner"])}static getInstance(){return this.instance||(this.instance=new s),this.instance}cleanupLocalStorageMatchConditions(e=(e=>!1)){const t=Object.keys(window.localStorage);for(const n of t)e(n)&&window.localStorage.removeItem(n)}cleanupKeysOfLocalStorage(e=[]){for(const t of e)window.localStorage.removeItem(t)}clearLocalStorage(){window.localStorage.clear()}async cleanupAsyncLocalStorageMatchConditions(e=(e=>!1)){const t=r.default.getInstance(),n=[t.Storage.FriendBlocked,t.Storage.InfoCache,t.Storage.RetryCache,t.SecureLocalstorage.AsyncStore],i=[];for(const a of n){const t=await a.getAllKey();if(0===t.length)continue;if(Array.isArray(t[0])){this.logger.zsymb(9,"dqKDNz",['"{}" store has array-typed keys; then can\'t be matched for cleaning up',"dwajxa"],a.name);continue}const n=[];for(const i of t)e(`${i}`)&&n.push(i);n.length&&i.push(a.deleteMulti(n))}i.length&&await Promise.all(i)}async clearAsyncLocalStorage(){const e=r.default.getInstance(),t=[e.Storage.FriendBlocked,e.Storage.InfoCache,e.Storage.RetryCache,e.SecureLocalstorage.AsyncStore];return Promise.all(t.map((e=>e.clear())))}}s.instance=null},UJ0r:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var i=n("jDHv"),a=n("AH6j");n("PmZf");class r extends a.b{}const s=Object(i.define)("database-adapter-manager")},UK4g:function(e,t,n){"use strict";n.d(t,"j",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"i",(function(){return r})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"h",(function(){return l})),n.d(t,"k",(function(){return d})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"m",(function(){return h})),n.d(t,"l",(function(){return y}));const i=0,a=void 0,r=2,s="db",o=1e4,l=0,d=1e4,c=1e4,u="Database",p=!1,m="_",h="/",y="dal"},Uzj0:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"d",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"f",(function(){return y}));var i=n("VTBJ");let a,r,s;let o,l;!function(e){let t;async function n(e,t){return await Promise.all(e.map(((e,n,i)=>t(e,n,i))))}!function(e){let t,n=function(e){return e[e.ASC=1]="ASC",e[e.DES=-1]="DES",e}({});var i;e.Order=n,e.create=function(e){return(t,i)=>{for(let a=0;a<e.length;a++){const r=e[a],s=r.comparer(t[r.key],i[r.key]);if(0!==s)return r.order===n.DES?s*r.order:s}return 0}},(i=t||(t=e.Comparer||(e.Comparer={}))).bool=function(e,t){if(e||t){if(!e)return 1;if(!t)return-1}return 0},i.number=function(e,t){return e>t?1:e<t?-1:0},i.string=function(e,t){return e>t?1:e<t?-1:0}}(t||(t=e.Sorter||(e.Sorter={}))),e.asyncForEach=async function(e,t){for(let n=0;n<e.length;n++)await t(e[n],n,e)},e.asyncFilter=async function(e,t){let n=[];for(let i=0;i<e.length;i++)await t(e[i],i,e)&&n.push(e[i]);return n},e.asyncFilterParallel=async function(e,t){const i=await n(e,t),a=[];for(let n=0;n<e.length;n++)i[n]&&a.push(e[n]);return a},e.asyncMap=async function(e,t){let n=[];for(let i=0;i<e.length;i++)n.push(await t(e[i],i,e));return n},e.asyncMapParallel=n;e.safeParseJson=e=>{try{const t=JSON.parse(e);if(!Array.isArray(t))throw new Error("Object is not an array");return[null,t]}catch(t){return[t,[]]}},e.merge=(e,t)=>Array.from(new Set(e.concat(t)))}(a||(a={})),function(e){e.catchFn=e=>{try{return[null,e()]}catch(t){return[t,null]}},e.catchAsyncFn=async e=>{try{return[null,await e()]}catch(t){return[t,null]}},e.catchPromise=async e=>{try{return[null,await e]}catch(t){return[t,null]}};function t(e=0){return new Promise((t=>{setTimeout(t,e)}))}e.delay=t,e.timeout=function(e,n,i){return Promise.race([t(n).then((()=>i)),e])};let n;e.Container=class{constructor(){this.resolve=()=>{},this.reject=()=>{},this.promise=void 0,this.value=void 0,this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.value=t,e(t)},this.reject=t}))}},(n||(n=e.Macrotask||(e.Macrotask={}))).push=function(e){setTimeout(e,0)}}(r||(r={})),(s||(s={})).getNumberOfDays=function(e,t){const n=new Date(e),i=new Date(t).getTime()-n.getTime();return Math.round(i/864e5)},function(e){e.map=function(e,t){return Object.keys(e).reduce((function(n,i){return n[i]=t(i,e[i]),n}),{})};e.isEmptyObject=e=>"object"==typeof e&&!Object.keys(e),e.isNotEmptyObject=e=>"object"==typeof e&&!!Object.keys(e),e.clone=(e,t="shalow")=>"deep"===t?JSON.parse(JSON.stringify(e)):Object(i.a)({},e),e.safeParseJson=e=>{try{return[null,JSON.parse(e)]}catch(t){return[t,{}]}},e.getProperty=(e,t)=>{var n,i;return null!==(n=null!==(i=e[t])&&void 0!==i?i:e[t.toLowerCase()])&&void 0!==n?n:e[t.toUpperCase()]};e.Comparer=class{constructor(e,t,n){this.object1=e,this.object2=t,this.result=void 0,this.result=null!=n&&n}AND(e,t){return this.result=this.result&&this.compareField(e,t),this}OR(e,t){return this.result=this.result||this.compareField(e,t),this}exec(){return this.result}compareField(e,t){var n;const i=this.object1[e],a=this.object2[e];return null!==(n=null==t?void 0:t(i,a))&&void 0!==n?n:i==a}}}(o||(o={})),function(e){const t=[-1,1,1];e.get=e=>{if(e>t.length-1)for(let n=t.length;n<=e;n++)t.push(t[e-1]+t[e-2]);return t[e]}}(l||(l={}));const d="undefined"!=typeof window&&"Microsoft Internet Explorer"==(null===(c=window)||void 0===c||null===(u=c.navigator)||void 0===u?void 0:u.appName);var c,u;let p;var m;let h,y;(m=p||(p={})).encrypt=function(e,t){let n=0,i=[];if(d){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")},m.decrypt=function(e,t){let n=0,i=[];if(d){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a,n=a-n;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")},function(e){const t=36e5,n=24*t,i={W:7*n,D:n,h:t,m:6e4,s:1e3,ms:1},a=e.timeInMs=e=>{const t=/(\d+)(ms|s|m|h|D|W)/g;let n,a=0;for(;n=t.exec(e);)a+=parseInt(n[1])*i[n[2]];return a};e.countDays=(e,t)=>{if(e>t)return 0;const n=new Date(e),i=new Date(t);n.setHours(0,0,0,0),i.setHours(0,0,0,0);const r=i.getTime()-n.getTime();return Math.ceil(r/a("1D"))+1},e.countUniqDays=(...e)=>{const t=new Set;return e.forEach((e=>{const n=new Date(e);n.setHours(0,0,0,0),t.add(n.getTime())})),t.size}}(h||(h={})),function(e){const t=1048576,n={GB:1073741824,MB:t,KB:1024,byte:1};e.sizeInByte=e=>{const t=/(\d+)(byte|KB|MB|GB)/g;let i,a=0;for(;i=t.exec(e);)a+=parseInt(i[1])*n[i[2]];return a},e.bytesToMB=e=>e/t}(y||(y={}))},WOPK:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("kQx2");let a=0;const r=()=>(a++,Math.floor(Object(i.a)()+a))},X2RP:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));var i=n("jDHv"),a=n("AH6j"),r=n("Mgpg"),s=n("DI/x");n("PmZf");let o=function(e){return e.FAILED_MULTI="failed-multi",e}({});class l extends a.b{constructor(){super(),this.logger=void 0;const e=i.ModuleContainer.resolve(r.ZLoggerFactory);this.logger=e.createZLogger("query-executor",[this.getExecutorName()])}validateKey(e,t,n){if(!e.getIndex(t).validateKey(n))throw new s.o("The query key is invalid!");return n}}},XB6V:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("zlogger-factory")},YEoC:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"h",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"g",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return c}));let i=function(e){return e.NEXT="next",e.NEXT_UNIQUE="nextunique",e.PREV="prev",e.PREV_UNIQUE="prevunique",e}({}),a=function(e){return e.integer="integer",e.float="float",e.string="string",e.boolean="boolean",e.blob="blob",e.json="json",e}({}),r=function(e){return e.IMPACT_FULL="impact_full",e.IMPACT_PARTIAL="impact_partial",e}({}),s=function(e){return e.READONLY="readonly",e.READWRITE="readwrite",e}({}),o=function(e){return e[e.BLOCKING=0]="BLOCKING",e[e.NON_BLOCKING=50]="NON_BLOCKING",e[e.LOW=100]="LOW",e[e.IDLE=250]="IDLE",e[e.NEVER_TIMEOUT=1e3]="NEVER_TIMEOUT",e}({}),l=function(e){return e[e.IDB=0]="IDB",e[e.SQLite=1]="SQLite",e}({}),d=function(e){return e[e.BeginTransaction=0]="BeginTransaction",e[e.CommitTransaction=1]="CommitTransaction",e[e.Clear=2]="Clear",e[e.Get=3]="Get",e[e.GetAndUpdate=4]="GetAndUpdate",e[e.GetMulti=5]="GetMulti",e[e.GetAll=6]="GetAll",e[e.GetAllKey=7]="GetAllKey",e[e.Insert=8]="Insert",e[e.InsertMulti=9]="InsertMulti",e[e.Update=10]="Update",e[e.UpdateMulti=11]="UpdateMulti",e[e.Delete=12]="Delete",e[e.DeleteMulti=13]="DeleteMulti",e[e.FindAndDelete=14]="FindAndDelete",e[e.Count=15]="Count",e[e.CloseDB=16]="CloseDB",e[e.CloseAllDBs=17]="CloseAllDBs",e[e.DeleteDB=18]="DeleteDB",e[e.DeleteAllDBs=19]="DeleteAllDBs",e[e.GetMultiIfExists=20]="GetMultiIfExists",e}({}),c=function(e){return e[e.Unknown=0]="Unknown",e[e.Background=1]="Background",e[e.Host=2]="Host",e[e.Client=3]="Client",e[e.Worker=4]="Worker",e[e.Browser=5]="Browser",e}({})},YZti:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return p}));var i=n("MWu7"),a=n("g/Dz"),r=n("YEoC"),s=n("DI/x");const o="undefined"!=typeof window&&"Microsoft Internet Explorer"==(null===(l=window.navigator)||void 0===l?void 0:l.appName);var l;let d;var c;let u;let p;var m;(c=d||(d={})).encrypt=function(e,t){let n=0,i=[];if(o){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")},c.decrypt=function(e,t){let n=0,i=[];if(o){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a,n=a-n;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")},(u||(u={})).getTypeName=function(e){switch(e){case r.e.BeginTransaction:return"begin-transaction";case r.e.CommitTransaction:return"commit-transaction";case r.e.Clear:return"clear";case r.e.Get:return"get";case r.e.GetAndUpdate:return"get-and-update";case r.e.GetMulti:return"get-multi";case r.e.GetMultiIfExists:return"get-multi-if-exists";case r.e.GetAll:return"get-all";case r.e.GetAllKey:return"get-all-key";case r.e.Insert:return"insert";case r.e.InsertMulti:return"insert-multi";case r.e.Update:return"update";case r.e.UpdateMulti:return"update-multi";case r.e.Delete:return"delete";case r.e.DeleteMulti:return"delete-multi";case r.e.FindAndDelete:return"find-and-delete";case r.e.Count:return"count";case r.e.CloseDB:return"close-db";case r.e.CloseAllDBs:return"close-all-dbs";case r.e.DeleteDB:return"delete-db";case r.e.DeleteAllDBs:return"delete-all-dbs"}},(m=p||(p={})).isMissingTableError=function(e){return e instanceof s.e&&e.code===s.r},m.isInvalidVersionError=function(e){return e instanceof s.e&&e.code===s.n},m.isFailedToOpenConnectionError=function(e){return e instanceof s.e&&e.code===s.k},m.isOutOfMemError=function(e){return a.a.isOutOfMemError(e)||i.a.isOutOfMemError(e)}},ZcVI:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"k",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return c})),n.d(t,"q",(function(){return u})),n.d(t,"o",(function(){return p})),n.d(t,"p",(function(){return m})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return y})),n.d(t,"g",(function(){return g})),n.d(t,"l",(function(){return f})),n.d(t,"m",(function(){return b})),n.d(t,"n",(function(){return I}));const i="conversation",a="friend",r="group",s="message",o="group_info",l="ac",d="acv2",c="aco",u="sock_msg",p="sock_ac",m="sock_aco",h="actr",y="actrv2",g="actro",f="sock_ctrl",b="sock_ctrl_ac",I="sock_ctrl_aco"},b3Jv:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv");const l={IdxQueue:new s.d({tableName:"idx_queue",name:"IdxQueue",fields:{msgId:{name:"msgId",type:a.h.string},toUid:{name:"toUid",type:a.h.string},message:{name:"message",type:a.h.json},msgType:{name:"msgType",type:a.h.integer},ts:{name:"ts",type:a.h.string},fromUid:{name:"fromUid",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0}}}),StCont:new s.d({tableName:"stcont",name:"StCont",fields:{msgId:{name:"msgId",type:a.h.string},convId:{name:"convId",type:a.h.string},msgType:{name:"msgType",type:a.h.integer},index:{name:"index",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"index"}],unique:!0,autoIncrement:!0},msgId:{name:"msgId",fields:[{type:"raw",field:"msgId"}],unique:!0}}}),StIdx:new s.d({tableName:"stidx",name:"StIdx",fields:{keywordId:{name:"keywordId",type:a.h.integer},contentId:{name:"contentId",type:a.h.integer},freq:{name:"freq",type:a.h.integer},index:{name:"index",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"index"}],unique:!0,autoIncrement:!0},keywordId:{name:"keywordId",fields:[{type:"raw",field:"keywordId"}],unique:!1}}}),StKeyword:new s.d({tableName:"stkw",name:"StKeyword",fields:{keyword:{name:"keyword",type:a.h.string},index:{name:"index",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"index"}],unique:!0,autoIncrement:!0},keyword:{name:"keyword",fields:[{type:"raw",field:"keyword"}],unique:!0}}})},d={name:"Search",session:!0},c={partitionNamingStrategy:[r.a.byUser(),r.a.const("Search")],partitionsMap:Object(o.a)(l)},u={partitionNamingStrategy:[r.a.const("sidx"),r.a.byUser()],partitionsMap:Object(o.a)(l)},p=Object(i.a)(Object(i.a)(Object(i.a)({},d),c),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_PARTIAL}),m=Object(i.a)(Object(i.a)(Object(i.a)({},d),u),{},{version:2,milestoneVersion:2,type:a.a.IDB});let h=null,y=null;t.a={baseConfig:d,schema:l,get useSqlite(){return null===h&&(h=new s.a(p)),h},get useIdb(){return null===y&&(y=new s.a(m)),y}}},bSii:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o}));var i=n("igA5");n("YEoC");function a(e){return 1===e.length?e[0]:e}const r="pktmr";function s(e){i.default.getInstance().setItemForCurrentUser(r,e?"1":"0")}function o(){return"1"===i.default.getInstance().getItemForCurrentUser(r)}},"d/or":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("database-settings-manager")},d04y:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv");const l=new s.d({tableName:"actionlog",name:"Actionlog",fields:{type:a.h.string},indices:{},isNonFieldlikeEntity:!0}),d={Qoslogv2:new s.d({tableName:"qoslogv2",name:"Qoslogv2",fields:{record:{name:"record",type:a.h.string},ts:{name:"ts",type:a.h.integer},cmdId:{name:"cmdId",type:a.h.string},type:{name:"type",type:a.h.string},requestId:{name:"requestId",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"ts"},{type:"raw",field:"cmdId"},{type:"raw",field:"type"}],unique:!0},ts:{name:"ts",fields:[{type:"raw",field:"ts"}],unique:!1}}}),Actionlog:l},c={name:"Qos",session:!1},u={partitionNamingStrategy:[r.a.const("Qos")],partitionsMap:Object(o.a)(d)},p={partitionNamingStrategy:[r.a.const("zdb_qos")],partitionsMap:Object(o.a)(d)},m=Object(i.a)(Object(i.a)(Object(i.a)({},c),u),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_PARTIAL}),h=Object(i.a)(Object(i.a)(Object(i.a)({},c),p),{},{version:3,milestoneVersion:3,type:a.a.IDB});let y=null,g=null;t.a={baseConfig:c,schema:d,get useSqlite(){return null===y&&(y=new s.a(m)),y},get useIdb(){return null===g&&(g=new s.a(h)),g}}},fsN4:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var i=n("jDHv"),a=n("+ExH"),r=n("1UUk");class s{static getInstance(){if(!this.instance){const e=i.ModuleContainer.resolve(r.b);this.instance=e.createQueryBuilder(a.b)}return this.instance}}s.instance=null},fsQs:function(e,t,n){"use strict";n.d(t,"i",(function(){return i})),n.d(t,"g",(function(){return r})),n.d(t,"h",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"m",(function(){return l})),n.d(t,"o",(function(){return d})),n.d(t,"u",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"p",(function(){return p})),n.d(t,"n",(function(){return m})),n.d(t,"d",(function(){return h})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return g})),n.d(t,"q",(function(){return f})),n.d(t,"l",(function(){return b})),n.d(t,"j",(function(){return I})),n.d(t,"k",(function(){return v})),n.d(t,"r",(function(){return C})),n.d(t,"e",(function(){return w})),n.d(t,"t",(function(){return T})),n.d(t,"s",(function(){return S}));const i=1024,a=i*i,r=1e3,s=2e3,o=5e3,l=1e5,d=3e5,c=62,u=1e3,p={SESSION_MAX:32767,SESSION_LINE_MAX:4294967295},m={line_malloc:10*i,mem_batch_lim:500*i,line_hard_lim:30+50*i,line_soft_lim:30+4*i,file_lim:10*a,page_limit:10*a},h=m,y={i8:1,ui8:1,i16:2,ui16:2,i32:4,ui32:4,float32:4,float64:4,big64:8,ubig64:8};let g=function(e){return e[e.OK=0]="OK",e[e.ENCODE_LATER=1]="ENCODE_LATER",e[e.REWIND=2]="REWIND",e[e.OVERSIZE_NEXTPAGE=3]="OVERSIZE_NEXTPAGE",e}({});const f=!1,b=2048,I=2*a,v=300,C=[17,127],w={min:200,max:500,maxRetries:5},T=!1,S="unload-zlog"},"g/Dz":function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return p})),n.d(t,"d",(function(){return y}));var i=n("xpEm"),a=n("DI/x"),r=n("YEoC");function s(e){return new Promise(((t,n)=>{e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result)}))}function o(e,t,n){return`Invalid filter value for this method: '${e}' - Expected type: '${t}' - Actual type: '${n}'`}function l(e,t){const n=Object(i.m)(t,{operations:{AND:i.a,OR:i.k,NOT:i.j,gt:i.c,gte:i.d,lt:i.f,lte:i.g,in:i.e,notIn:i.i,eq:i.b,notEq:i.h,contains(e,t,n){if("string"!=typeof e){const t=o("contains","string",typeof e);throw new a.o(t)}return Object(i.l)((t=>"string"==typeof t&&t.includes(e)),t,n)},startsWith(e,t,n){if("string"!=typeof e){const t=o("startsWith","string",typeof e);throw new a.o(t)}return Object(i.l)((t=>"string"==typeof t&&t.startsWith(e)),t,n)},endsWith(e,t,n){if("string"!=typeof e){const t=o("endsWith","string",typeof e);throw new a.o(t)}return Object(i.l)((t=>"string"==typeof t&&t.endsWith(e)),t,n)}}});return n(e)}let d;var c;function u(e,t,n){const i=n;if(!e.isNonFieldlikeEntity){const{primaryIndex:n}=e,a=n.fields[0].field;Object.prototype.hasOwnProperty.call(i,a)||(i[a]=t)}return i}(c=d||(d={})).isVersionError=function(e){return e instanceof DOMException&&"VersionError"===e.name},c.getCurrentVersionFromVersionError=function(e){if(!d.isVersionError(e))return NaN;const t=[...e.message.matchAll(/\(\d+\)/g)];if(!t.length)return-1;const n=t[1][0];return+n.slice(1,n.length-1)},c.isInvalidStateError=function(e){return e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code)},c.isOutOfMemError=function(e){if(!(e instanceof Error))return!1;const{name:t,message:n}=e;return"QuotaExceededError"===t||"AbortError"===t&&n.includes("Version change transaction was aborted in upgradeneeded event handler.")};const p=e=>{const{from:t,to:n}=e;if(Array.isArray(t)&&Array.isArray(n)){const e=Math.min(t.length,n.length);if(e>1)for(let i=0;i<e;i+=1){if(t[i]!==n[i]&&i!==e-1)return!0}}return!1},m=e=>{switch(typeof e){case"number":if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return new Date(-864e13);if(0===e)return Number.MIN_VALUE;let t=Math.abs(e);for(;e+t/2!==e;)t/=2;return e+t;case"string":return e+"\0";default:throw TypeError("Unsupported key type: "+e)}},h=e=>{switch(typeof e){case"number":if(e===-1/0)throw TypeError("Unsupported key type: "+e);if(e===1/0)return Number.MAX_VALUE;if(0===e)return-Number.MIN_VALUE;let t=Math.abs(e);for(;e-t/2!==e;)t/=2;return e-t;case"string":return(e=>{const t=Array.from(e);for(let n=t.length-1;n>=0;n--){const e=t[n].charCodeAt(0)-1;if(e>=0){t[n]=String.fromCharCode(e);break}}return t.join("")})(e);default:throw TypeError("Unsupported key type: "+e)}},y=(e,t,n=r.c.NEXT)=>{const i=t.lower,a=t.upper,s=n===r.c.PREV||n===r.c.PREV_UNIQUE;for(let r=1;r<e.length;++r){const t=e.slice(r),n=i.slice(r),o=a.slice(r);if(s){if(indexedDB.cmp(t,o)>0)return e.slice(0,r).concat(o);if(indexedDB.cmp(t,n)<0)return e.slice(0,r).concat([h(e[r])]).concat(a.slice(r+1))}else{if(indexedDB.cmp(t,n)<0)return e.slice(0,r).concat(n);if(indexedDB.cmp(t,o)>0)return e.slice(0,r).concat([m(e[r])]).concat(i.slice(r+1))}}return null}},ibl3:function(e,t){},igA5:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var i=n("8/YW"),a=n("jDHv"),r=n("wudS"),s=n("fsN4"),o=n("Mgpg"),l=n("SWKE");const d="citk",c="citv",u="default_cache_map",p="z_ecrp",m="undefined"!=typeof window&&"Microsoft Internet Explorer"==(null===(h=window)||void 0===h||null===(y=h.navigator)||void 0===y?void 0:y.appName);var h,y;class g{static encrypt(e,t){if(!t)throw new Error("key is not set!");let n=0,i=[];if(m){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")}static decrypt(e,t){if(!t)throw new Error("key is not set!");let n=0,i=[];if(m){let n=0,a=e.length;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e);n%=a,n=a-n;for(let t=0;t<e.length;t++)i.push(String.fromCharCode(e.charCodeAt((t+n)%a)))}else for(let a=0;a<e.length;a++)i.push(String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(n))),n++,n>t.length-1&&(n=0);return i.join("")}}var f,b;let I=Object(i.g)()(f=Reflect.metadata("design:type",Function)(f=Reflect.metadata("design:paramtypes",[])(((b=class e{constructor(){this.userScopedPrefix=void 0,this.secretKey=void 0,this._decryptFn=void 0,this._encryptFn=void 0,this._canModifyData=void 0,this._disableCipher=void 0,this.onItemPlainChangedHandlers=new Map,this.onItemChangedHandlers=new Map,this.onItemChangedForCurrentUserHandlers=new Map,this.onItemPlainChangedAsyncHandlers=new Map,this.onItemChangedAsyncHandlers=new Map,this.onItemChangedForCurrentUserAsyncHandlers=new Map,this._cacheMaps={},this._flushAndSaveToStorage=void 0,this._logger=void 0,this.userScopedPrefix=null,this.secretKey=null,this._decryptFn=g.decrypt,this._encryptFn=g.encrypt,this._canModifyData=!0,this._disableCipher=!1,this._flushAndSaveToStorage=((e,t)=>{let n=null;return function(...i){n&&clearTimeout(n),n=setTimeout((()=>{e(...i)}),t)}})(this._flushAndSaveToStorageReal.bind(this),500)}get logger(){if(!this._logger){const e=a.ModuleContainer.resolve(o.ZLoggerFactory);this._logger=e.createZLogger("localstorage",["secure"])}return this._logger}static getInstance(){return this.instance||(this.instance=new e),this.instance}onAuthenticating(t){const{userId:n,UIN:i}=t.getSession();e.getInstance().init(n,i)}setCanModifyDataFlag(e){this._canModifyData=e}isEncryptedValue(e){return e.startsWith(`${p}_`)}disableCipher(){this._disableCipher=!0}_warnIfKeyCannotBeModified(e){this._canModifyData}init(e,t){this.secretKey=t,this._initUserIDList(e);try{this._testCipher()}catch(n){}}resetSession(){this.secretKey=null,this.userScopedPrefix=null}hasAlreadyInitialized(){return null!==this.secretKey&&null!==this.userScopedPrefix}_initUserIDList(e){try{this._validateUserIDList(),this.userScopedPrefix=`${Object(r.d)(e)}`}catch(t){}}_validateUserIDList(){}_testCipher(){if(this.checkExistForCurrentUser(d)){if(this.getSecureItemForCurrentUser(d)!==c)throw new Error("SecureLocalStorage encryption and decryption produce incorrect results")}else this.setSecureItemForCurrentUser(d,c)}async _recoverCipher(){const e=["z_recentp","quest_cert","z_recentin","s_ph_if","z_listroom","z_c_d","zv_cu","auto-replies-state-v1","introduced-ttl","hide-fbadge","g_token","d_token","list_recent_search","list_recent_search_v2","ttl-v1","ttl-v1-saved","fas","feat-pro-count-auto-replies"],t=t=>!(!t.includes("list_recent_g_search")||!t.endsWith("v2"))||e.some((e=>t.includes(e))),n=l.a.getInstance();n.cleanupLocalStorageMatchConditions(t);await n.cleanupAsyncLocalStorageMatchConditions((e=>"string"==typeof e&&t(e))),this.setSecureItemForCurrentUser(d,c)}hasOwnProperty(e){const t=this.getKeyNameForSharedItem(e);let n=null;return this.hasAlreadyInitialized()&&(n=this.getKeyNameForCurrentUser(e)),Object.hasOwnProperty.call(this,e)||null!==globalThis.localStorage.getItem(t)||null!==n&&null!==globalThis.localStorage.getItem(n)||null!==globalThis.localStorage.getItem(e)}getKeyNameForSharedItem(e){return`sh_${e}`}getKeyNameForCurrentUser(e){if(null===this.userScopedPrefix)throw new Error("SecureLocalStorage instance hasn't been initialized yet!");return`${this.userScopedPrefix}_${e}`}getItemPlain(e){return globalThis.localStorage.getItem(e)}setItemPlain(e,t){this._warnIfKeyCannotBeModified(e),globalThis.localStorage.setItem(e,t),this.applyItemPlainChanged(e,t)}async getItemPlainAsync(e){const t=s.default.getInstance(),{val:n}=await t.SecureLocalstorage.AsyncStore.get(e)||{val:null};return n}async setItemPlainAsync(e,t){this._warnIfKeyCannotBeModified(e);const n=s.default.getInstance();await n.SecureLocalstorage.AsyncStore.insert({key:e,val:t},{replace:!0}),this.applyItemPlainChangedAsync(e,t)}getItem(e){const t=this.getKeyNameForSharedItem(e);return globalThis.localStorage.getItem(t)}setItem(e,t){const n=this.getKeyNameForSharedItem(e);this._warnIfKeyCannotBeModified(n),globalThis.localStorage.setItem(n,t),this.applyItemChanged(e,t)}async getItemAsync(e){const t=this.getKeyNameForSharedItem(e),n=s.default.getInstance(),{val:i}=await n.SecureLocalstorage.AsyncStore.get(t)||{val:null};return i}async setItemAsync(e,t){const n=this.getKeyNameForSharedItem(e);this._warnIfKeyCannotBeModified(n);const i=s.default.getInstance();await i.SecureLocalstorage.AsyncStore.insert({key:n,val:t},{replace:!0}),this.applyItemChangedAsync(e,t)}getItemForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);return globalThis.localStorage.getItem(t)}setItemForCurrentUser(e,t){const n=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(n),globalThis.localStorage.setItem(n,t),this.applyItemChangedForCurrentUser(e,t)}async getItemForCurrentUserAsync(e){const t=this.getKeyNameForCurrentUser(e),n=s.default.getInstance(),{val:i}=await n.SecureLocalstorage.AsyncStore.get(t)||{val:null};return i}async setItemForCurrentUserAsync(e,t){const n=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(n);const i=s.default.getInstance();await i.SecureLocalstorage.AsyncStore.insert({key:n,val:t},{replace:!0}),this.applyItemChangedForCurrentUserAsync(e,t)}getSecureItemForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e),n=globalThis.localStorage.getItem(t);if(null===n)return null;return this._disableCipher&&!this.isEncryptedValue(n)?n:this.decryptValue(n)}setSecureItemForCurrentUser(e,t){const n=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(n);const i=t;if(null===this.secretKey)throw new Error("SecureLocalStorage instance hasn't been initialized yet!");const a=this._disableCipher?i:this.encryptValue(i);globalThis.localStorage.setItem(n,a),this.applyItemChangedForCurrentUser(e,t)}async getSecureItemForCurrentUserAsync(e){const t=this.getKeyNameForCurrentUser(e),n=s.default.getInstance(),i=await n.SecureLocalstorage.AsyncStore.get(t);if(!i)return null;const{val:a}=i;return this._disableCipher&&!this.isEncryptedValue(a)?a:this.decryptValue(a)}async setSecureItemForCurrentUserAsync(e,t){const n=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(n);const i=t;if(null===this.secretKey)throw new Error("SecureLocalStorage instance hasn't been initialized yet!");const a=this._disableCipher?i:this.encryptValue(i),r=s.default.getInstance();await r.SecureLocalstorage.AsyncStore.insert({key:n,val:a},{replace:!0}),this.applyItemChangedForCurrentUserAsync(e,t)}removeItemPlain(e){this._warnIfKeyCannotBeModified(e),globalThis.localStorage.removeItem(e),this.applyItemPlainChanged(e,null)}removeItem(e){const t=this.getKeyNameForSharedItem(e);this._warnIfKeyCannotBeModified(t),globalThis.localStorage.removeItem(t),this.applyItemChanged(e,null)}removeItemForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(t),globalThis.localStorage.removeItem(t),this.applyItemChangedForCurrentUser(e,null)}async removeItemPlainAsync(e){this._warnIfKeyCannotBeModified(e);const t=s.default.getInstance();await t.SecureLocalstorage.AsyncStore.delete(e),this.applyItemPlainChangedAsync(e,null)}async removeItemAsync(e){const t=this.getKeyNameForSharedItem(e);this._warnIfKeyCannotBeModified(t);const n=s.default.getInstance();await n.SecureLocalstorage.AsyncStore.delete(t),this.applyItemChangedAsync(e,null)}async removeItemForCurrentUserAsync(e){const t=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(t);const n=s.default.getInstance();await n.SecureLocalstorage.AsyncStore.delete(t),this.applyItemChangedForCurrentUserAsync(e,null)}setItemForAllLoggedUsers(e,t){const n=Object(r.e)().length;if(0!==n){for(let i=0;i<n;i+=1){const n=`${i}_${e}`;globalThis.localStorage.setItem(n,t)}this.applyItemChangedForCurrentUser(e,t)}}static forTestingOnly_getNewInstance(){return new e}getInt(e,t={}){const n=void 0===t.defaultInt||isNaN(t.defaultInt)?-1:+t.defaultInt;try{const t=this.getKeyNameForSharedItem(e),n=globalThis.localStorage.getItem(t);if(null!=n){const e=+n;if(!isNaN(e))return e}}catch(i){}return n}getIntForCurrentUser(e,t={}){const n=void 0===t.defaultInt||isNaN(t.defaultInt)?-1:+t.defaultInt;try{const t=this.getKeyNameForCurrentUser(e);let n=globalThis.localStorage.getItem(t);if(null!=n){const e=+n;if(!isNaN(e))return e}}catch(i){}return n}setObject(e,t){try{const n=this.getKeyNameForSharedItem(e);this._warnIfKeyCannotBeModified(e);const i=JSON.stringify(t);globalThis.localStorage.setItem(n,i),this.applyItemChanged(e,i)}catch(n){}}setObjectForCurrentUser(e,t){try{const n=this.getKeyNameForCurrentUser(e);this._warnIfKeyCannotBeModified(n);const i=JSON.stringify(t);globalThis.localStorage.setItem(n,i),this.applyItemChangedForCurrentUser(e,i)}catch(n){}}getObject(e){const t=this.getKeyNameForSharedItem(e),n=globalThis.localStorage.getItem(t);if(null===n)return null;const i=JSON.parse(n);return i&&"object"==typeof i?i:null}getObjectForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);let n=globalThis.localStorage.getItem(t);return null===n?null:(n=JSON.parse(n),n&&"object"==typeof n?n:null)}getParsedItem(e){const t=this.getKeyNameForSharedItem(e);let n=globalThis.localStorage.getItem(t);if(n)try{const e=JSON.parse(n);null!=e&&(n=e)}catch(i){}return n}getParsedItemForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);let n=globalThis.localStorage.getItem(t);if(n)try{const e=JSON.parse(n);null!=e&&(n=e)}catch(i){}return n}forEachKeyName(e=((e,t)=>{})){Object.keys(globalThis.localStorage).forEach(e)}_getCacheMap(e){if(!this._cacheMaps[e]){let n=new Map,i=globalThis.localStorage.getItem(e);if(i)try{n=JSON.parse(i).reduce(((e,t)=>{const[n,i]=t;return e.set(n,i),e}),n)}catch(t){}this._cacheMaps[e]=n}return this._cacheMaps[e]}_flushAndSaveToStorageReal(e){const t=this._getCacheMap(e),n=[];t.forEach(((e,t)=>{n.push([t,e])}));const i=JSON.stringify(n);globalThis.localStorage.setItem(e,i),this.applyItemChangedForCurrentUser(e,i)}addEntryToCacheMap(e,t,n=u){const i=this.getKeyNameForSharedItem(n);this._getCacheMap(i).set(e,t),this._flushAndSaveToStorage(i)}addEntryToCacheMapForCurrentUser(e,t,n=u){const i=this.getKeyNameForCurrentUser(n);this._getCacheMap(i).set(e,t),this._flushAndSaveToStorage(i)}deleteEntryFromCacheMap(e,t=u){const n=this.getKeyNameForSharedItem(t);this._getCacheMap(n).delete(e),this._flushAndSaveToStorage(n)}deleteEntryFromCacheMapForCurrentUser(e,t=u){const n=this.getKeyNameForCurrentUser(t);this._getCacheMap(n).delete(e),this._flushAndSaveToStorage(n)}getEntryOfCacheMap(e,t=u){const n=this.getKeyNameForSharedItem(t);return this._getCacheMap(n).get(e)||null}getEntryOfCacheMapForCurrentUser(e,t=u){const n=this.getKeyNameForCurrentUser(t);return this._getCacheMap(n).get(e)||null}forEachEntryOfCacheMap(e,t=u){const n=this.getKeyNameForSharedItem(t);this._getCacheMap(n).forEach(e)}forEachEntryOfCacheMapForCurrentUser(e,t=u){const n=this.getKeyNameForCurrentUser(t);this._getCacheMap(n).forEach(e)}getCacheMapSize(e=u){const t=this.getKeyNameForSharedItem(e);return this._getCacheMap(t).size}getCacheMapSizeForCurrentUser(e=u){const t=this.getKeyNameForCurrentUser(e);return this._getCacheMap(t).size}hasCacheMap(e){const t=this.getKeyNameForSharedItem(e);return void 0!==this._cacheMaps[t]}hasCacheMapForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);return void 0!==this._cacheMaps[t]}checkExist(e){const t=this.getKeyNameForSharedItem(e);return null!==globalThis.localStorage.getItem(t)}checkExistForCurrentUser(e){const t=this.getKeyNameForCurrentUser(e);return null!==globalThis.localStorage.getItem(t)}isUserScopedKeyOfCurrentUser(e){return e.startsWith(`${this.userScopedPrefix}_`)}getKeySignatureOfUserScopedKeyOfCurrentUser(e){if(!this.isUserScopedKeyOfCurrentUser(e))throw new Error(`${e} doesn't belong to the current user`);const t=`^${this.userScopedPrefix}_`,n=new RegExp(t,"g");return e.replace(n,"")}encryptValue(e){if("string"!=typeof e)throw new Error("SecureLocalStorage cannot encrypt non string value");if(null===this.secretKey)throw new Error("SecureLocalStorage instance hasn't been initialized yet!");return`${p}_${this._encryptFn(e,this.secretKey)}`}decryptValue(e){if("string"!=typeof e)throw new Error("SecureLocalStorage cannot decrypt non string value");if(null===this.secretKey)throw new Error("SecureLocalStorage instance hasn't been initialized yet!");return e=e.slice(`${p}_`.length),this._decryptFn(e,this.secretKey)}onItemPlainChanged(e,t){this.onItemPlainChangedHandlers.has(e)||this.onItemPlainChangedHandlers.set(e,[]);const n=this.onItemPlainChangedHandlers.get(e);n.push(t),this.onItemPlainChangedHandlers.set(e,n)}onItemChanged(e,t){this.onItemChangedHandlers.has(e)||this.onItemChangedHandlers.set(e,[]);const n=this.onItemChangedHandlers.get(e);n.push(t),this.onItemChangedHandlers.set(e,n)}onItemChangedForCurrentUser(e,t){this.onItemChangedForCurrentUserHandlers.has(e)||this.onItemChangedForCurrentUserHandlers.set(e,[]);const n=this.onItemChangedForCurrentUserHandlers.get(e);n.push(t),this.onItemChangedForCurrentUserHandlers.set(e,n)}onItemPlainChangedAsync(e,t){this.onItemPlainChangedAsyncHandlers.has(e)||this.onItemPlainChangedAsyncHandlers.set(e,[]);const n=this.onItemPlainChangedAsyncHandlers.get(e);n.push(t),this.onItemPlainChangedAsyncHandlers.set(e,n)}onItemChangedAsync(e,t){this.onItemChangedAsyncHandlers.has(e)||this.onItemChangedAsyncHandlers.set(e,[]);const n=this.onItemChangedAsyncHandlers.get(e);n.push(t),this.onItemChangedAsyncHandlers.set(e,n)}onItemChangedForCurrentUserAsync(e,t){this.onItemChangedForCurrentUserAsyncHandlers.has(e)||this.onItemChangedForCurrentUserAsyncHandlers.set(e,[]);const n=this.onItemChangedForCurrentUserAsyncHandlers.get(e);n.push(t),this.onItemChangedForCurrentUserAsyncHandlers.set(e,n)}applyItemPlainChanged(e,t){if(this.onItemPlainChangedHandlers.has(e)){const n=this.onItemPlainChangedHandlers.get(e);for(const i of n)i(t,e)}}applyItemChanged(e,t){if(this.onItemChangedHandlers.has(e)){const n=this.onItemChangedHandlers.get(e);for(const i of n)i(t,e)}}applyItemChangedForCurrentUser(e,t){if(this.onItemChangedForCurrentUserHandlers.has(e)){const n=this.onItemChangedForCurrentUserHandlers.get(e);for(const i of n)i(t,e)}}applyItemPlainChangedAsync(e,t){if(this.onItemPlainChangedAsyncHandlers.has(e)){const n=this.onItemPlainChangedAsyncHandlers.get(e);for(const i of n)i(t,e)}}applyItemChangedAsync(e,t){if(this.onItemChangedAsyncHandlers.has(e)){const n=this.onItemChangedAsyncHandlers.get(e);for(const i of n)i(t,e)}}applyItemChangedForCurrentUserAsync(e,t){if(this.onItemChangedForCurrentUserAsyncHandlers.has(e)){const n=this.onItemChangedForCurrentUserAsyncHandlers.get(e);for(const i of n)i(t,e)}}}).instance=null,f=b))||f)||f)||f},ipeT:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var i=n("VTBJ"),a=(n("jDHv"),n("Mgpg"),n("UK4g")),r=n("YEoC"),s=n("DI/x"),o=n("MRjZ");class l{constructor(e,t,n=0,i,a,r){this.database=e,this.tableConfig=t,this.transaction=n,this.doQuery=i,this.dispatchQueryErrorEvent=a,this.databaseConfig=r,this.bindedIndex=void 0}get name(){return this.tableConfig.name}queryBuilderReject(e,t){const n=Object(o.a)(t);return e.message+=` (${n})`,this.dispatchQueryErrorEvent(e),Promise.reject(e)}index(e){if(e==this.bindedIndex)return this;if(this.bindedIndex){const t=`Attempt to bind '${e}' to already-binded '${this.bindedIndex}' index`;throw new s.I("index",t)}const t=new l(this.database,this.tableConfig,this.transaction,this.doQuery,this.dispatchQueryErrorEvent,this.databaseConfig);return t.bindedIndex=e,t}clear(){return this.doQuery({trace:(...e)=>{},type:r.e.Clear,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:r.d.BLOCKING,retry:a.h,timing:{},meta:{databaseConfig:this.databaseConfig,error:new Error,dead:!1,step:-1}})}get(e,t={}){const n={trace:(...e)=>{},type:r.e.Get,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{key:e,index:this.bindedIndex||t.index||"primary"}};if(this.tableConfig.isNonFieldlikeEntity)return this.queryBuilderReject(new s.I("get","This method cannot be performed on non-fieldlike table!"),n);return this.doQuery(n)}getMulti(e,t={}){const n={trace:(...e)=>{},type:r.e.GetMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",keys:e,onValue:t.onValue}};return this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("getMulti","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}getMultiIfExists(e,t={}){const n={trace:(...e)=>{},type:r.e.GetMultiIfExists,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",keys:e}};return this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("getMulti","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}getAll(e,t={}){const n=c(t.limit),i={trace:(...e)=>{},type:r.e.GetAll,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",range:e,limit:n,direction:t.direction||r.c.NEXT,filter:t.filter,predicate:t.predicate,aborted:t.aborted,onValue:t.onValue,onProgress:t.onProgress,advance:t.advance,stepCount:t.stepCount,useKeyRangeV2:t.useKeyRangeV2||!1,useLGKeyRange:t.useLGKeyRange||!1}};return this.tableConfig.isNonFieldlikeEntity&&e?this.queryBuilderReject(new s.I("getAll","'getAll()' with range cannot be performed on non-fieldlike table!"),i):this.doQuery(i)}getAllKey(e,t={}){const n=c(t.limit),i={trace:(...e)=>{},type:r.e.GetAllKey,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",range:e,limit:n,direction:t.direction||r.c.NEXT,useKeyRangeV2:t.useKeyRangeV2||!1,useLGKeyRange:t.useLGKeyRange||!1}};return this.tableConfig.isNonFieldlikeEntity&&e?this.queryBuilderReject(new s.I("getAllKey","'getAllKey()' with range cannot be performed on non-fieldlike table!"),i):this.doQuery(i)}getAndUpdate(e,t={}){const n={trace:(...e)=>{},type:r.e.GetAndUpdate,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",key:e,updater:e=>e,ignoreNotFound:!1!==t.filterNotFound}};return t.updater?(n.params=Object(i.a)(Object(i.a)({},n.params),{},{updater:t.updater}),this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("getAndUpdate","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)):this.queryBuilderReject(new s.o("'updater' option is required!"),n)}insert(e,t={}){const n={trace:(...e)=>{},type:r.e.Insert,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{replace:!1!==t.replace,value:e}};if(Array.isArray(e))return this.queryBuilderReject(new s.I("insert","Receive an array as input! Please use 'insertMulti' instead!"),n);return this.doQuery(n)}put(e,t={}){throw new s.I("put","This method is legacy! Please use 'insert' instead")}async insertMulti(e,t={}){const n={trace:(...e)=>{},type:r.e.InsertMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{replace:!1!==t.replace,values:e,optimized:!!t.optimized}};return Array.isArray(e)?0===e.length?{success:[],fail:[]}:this.doQuery(n):this.queryBuilderReject(new s.I("insertMulti","Receive a non-array value as input! Please use 'insert' instead!"),n)}update(e,t={}){const n={trace:(...e)=>{},type:r.e.Update,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",key:e,attributes:[],value:{},ignoreNotFound:!0===t.ignoreNotFound}};return t.value&&t.attributes?(n.params=Object(i.a)(Object(i.a)({},n.params),{},{attributes:t.attributes,value:t.value}),this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("update","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)):this.queryBuilderReject(new s.o(`'${t.value?"attributes":"value"}' option is required!`),n)}updateMulti(e={}){const t={trace:(...e)=>{},type:r.e.UpdateMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:e.priority||r.d.NON_BLOCKING,retry:e.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:e.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||e.index||"primary",patches:e.patches||[],ignoreNotFound:!0===e.ignoreNotFound}};return this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("updateMulti","This method cannot be performed on non-fieldlike table!"),t):this.doQuery(t)}delete(e,t={}){const n={trace:(...e)=>{},type:r.e.Delete,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{key:e,index:this.bindedIndex||t.index||"primary"}};return this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("delete","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}remove(e,t={}){throw new s.I("remove","This method is legacy. Please use 'delete' instead!")}deleteMulti(e,t={}){const n={trace:(...e)=>{},type:r.e.DeleteMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{keys:e,index:this.bindedIndex||t.index||"primary"}};return this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("deleteMulti","This method cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}findAndDelete(e,t={}){const n={trace:(...e)=>{},type:r.e.FindAndDelete,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{range:e,filter:t.filter,index:this.bindedIndex||t.index||"primary",useKeyRangeV2:t.useKeyRangeV2||!1,useLGKeyRange:t.useLGKeyRange||!1}};return this.tableConfig.isNonFieldlikeEntity&&e?this.queryBuilderReject(new s.I("findAndDelete","'findAndDelete()' with range cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}count(e,t={}){const n={trace:(...e)=>{},type:r.e.Count,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:this.bindedIndex||t.index||"primary",range:e,useKeyRangeV2:t.useKeyRangeV2||!1,useLGKeyRange:t.useLGKeyRange||!1}};return this.tableConfig.isNonFieldlikeEntity&&e?this.queryBuilderReject(new s.I("count","'count()' with range cannot be performed on non-fieldlike table!"),n):this.doQuery(n)}get isNonFieldlikeEntity(){return this.tableConfig.isNonFieldlikeEntity}getIndexConfig(e){return this.tableConfig.getIndex(e)}}class d{constructor(e,t,n=0,i,a,r){this.database=e,this.tableConfig=t,this.transaction=n,this.doQuery=i,this.dispatchQueryErrorEvent=a,this.databaseConfig=r}get isNonFieldlikeEntity(){return this.tableConfig.isNonFieldlikeEntity}get name(){return this.tableConfig.name}queryBuilderReject(e,t){const n=Object(o.a)(t);return e.message+=` (${n})`,this.dispatchQueryErrorEvent(e),Promise.reject(e)}clear(){return this.doQuery({trace:(...e)=>{},type:r.e.Clear,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:r.d.BLOCKING,retry:a.h,timing:{},meta:{databaseConfig:this.databaseConfig,error:new Error,dead:!1,step:-1}})}async insert(e,t={}){const n={trace:(...e)=>{},type:r.e.Insert,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{replace:!1!==t.replace,value:e}};if(Array.isArray(e))return this.queryBuilderReject(new s.I("insert","Receive an array as input! Please use 'insertMulti' instead!"),n);await this.doQuery(n)}put(e,t={}){throw new s.I("put","This method is legacy! Please use 'insert' instead")}async insertMulti(e,t={}){const n={trace:(...e)=>{},type:r.e.InsertMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{replace:!1!==t.replace,values:e,optimized:!!t.optimized}};return Array.isArray(e)?1===e.length?this.insert(e[0],t):void(await this.doQuery(n)):this.queryBuilderReject(new s.I("insertMulti","Receive a non-array value as input! Please use 'insert' instead!"),n)}async update(e,t={}){const n={trace:(...e)=>{},type:r.e.Update,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:"primary",key:e,attributes:[],value:{},ignoreNotFound:!0===t.ignoreNotFound}};return t.value&&t.attributes?(n.params=Object(i.a)(Object(i.a)({},n.params),{},{attributes:t.attributes,value:t.value}),this.tableConfig.isNonFieldlikeEntity?this.queryBuilderReject(new s.I("update","This method cannot be performed on non-fieldlike table!"),n):void(await this.doQuery(n))):this.queryBuilderReject(new s.o(`'${t.value?"attributes":"value"}' option is required!`),n)}async updateMulti(e={}){const t={trace:(...e)=>{},type:r.e.UpdateMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:e.priority||r.d.NON_BLOCKING,retry:e.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:e.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{index:e.index||"primary",patches:e.patches||[],ignoreNotFound:!0===e.ignoreNotFound}};if(this.tableConfig.isNonFieldlikeEntity)return this.queryBuilderReject(new s.I("updateMulti","This method cannot be performed on non-fieldlike table!"),t);await this.doQuery(t)}async delete(e,t={}){const n={trace:(...e)=>{},type:r.e.Delete,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{key:e,index:t.index||"primary"}};if(this.tableConfig.isNonFieldlikeEntity)return this.queryBuilderReject(new s.I("delete","This method cannot be performed on non-fieldlike table!"),n);await this.doQuery(n)}async remove(e,t={}){throw new s.I("remove","This method is legacy. Please use 'delete' instead!")}async deleteMulti(e,t={}){const n={trace:(...e)=>{},type:r.e.DeleteMulti,database:this.database,table:this.tableConfig.name,transaction:this.transaction,priority:t.priority||r.d.NON_BLOCKING,retry:t.retry||a.h,timing:{},meta:{databaseConfig:this.databaseConfig,partitionKey:t.partition,error:new Error,timeout:a.k,step:-1,dead:!1},params:{keys:e,index:t.index||"primary"}};if(this.tableConfig.isNonFieldlikeEntity)return this.queryBuilderReject(new s.I("deleteMulti","This method cannot be performed on non-fieldlike table!"),n);await this.doQuery(n)}}function c(e){let t=e||a.g;return t>a.g&&(t=a.g),t}},jDHv:function(e,t,n){"use strict";n.r(t),n.d(t,"define",(function(){return a})),n.d(t,"Container",(function(){return r})),n.d(t,"ModuleContainer",(function(){return s})),n.d(t,"autoInjectable",(function(){return o})),n.d(t,"injectable",(function(){return l})),n.d(t,"inject",(function(){return d})),n.d(t,"singleton",(function(){return c}));var i=n("S8fy");n("h6tn");function a(e){return{service:e,token:e}}class r{constructor(){this.inject=e=>i.d(e.token),this.injectToken=e=>i.d(e),this.singleton=i.h,this.injectable=i.e,this.isRegistered=e=>i.c.isRegistered(e.token),this.register=(e,t)=>{i.c.register(e.token,{useClass:t}),this.hookAfferResolution(e)},this.registerValue=(e,t)=>{i.c.register(e.token,{useValue:t}),this.hookAfferResolution(e)},this.registerSingleton=(e,t)=>{i.c.registerSingleton(t),i.c.register(e.token,{useFactory:e=>e.resolve(t)}),this.hookAfferResolution(e)},this.registerFactory=(e,t)=>{i.c.register(e.token,{useFactory:t}),this.hookAfferResolution(e)},this.resolve=e=>i.c.resolve(e.token),this.resolveToken=e=>i.c.resolve(e),this.resolveAll=e=>i.c.resolveAll(e.token),this.resolveIfExist=e=>{try{return i.c.resolve(e.token)}catch(t){return}}}hookAfferResolution(e){}}const s=new r,o=i.b,l=i.e,d=e=>i.d(e.token);function c(e){return function(t){e?s.registerSingleton(e,t):s.singleton()(t)}}},jGDt:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("zlog-session")},kFM4:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const i={RunMode:n("YEoC").f.Unknown};function a(e,t){i[e]=t}},kQx2:function(e,t,n){"use strict";function i(){var e;return"function"==typeof(null===globalThis||void 0===globalThis||null===(e=globalThis.performance)||void 0===e?void 0:e.now)?globalThis.performance.now():Date.now()}n.d(t,"a",(function(){return i}))},mpOJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));let i=function(e){return e.ArrayBuffer="array-buffer",e.Blob="blob",e}({})},oRsZ:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq");const o=new s.d({tableName:"zcloud",name:"ZCloud",fields:{action:{name:"action",type:a.h.integer},noiseId:{name:"noiseId",type:a.h.string},actionType:{name:"actionType",type:a.h.integer},ts:{name:"ts",type:a.h.integer},cliTs:{name:"cliTs",type:a.h.integer},msgInfo:{name:"msgInfo",type:a.h.json},mediaInfo:{name:"mediaInfo",type:a.h.json},verified:{name:"verified",type:a.h.integer,nullable:!0},encryptInfo:{name:"encryptInfo",type:a.h.json,nullable:!0},zKey:{name:"zKey",type:a.h.string,nullable:!0},zDate:{name:"zDate",type:a.h.integer,nullable:!0},zSize:{name:"zSize",type:a.h.integer,nullable:!0},zConv:{name:"zConv",type:a.h.string,nullable:!0},zType:{name:"zType",type:a.h.string,nullable:!0},cloudInfo:{name:"cloudInfo",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"noiseId"}],unique:!0},zKey:{name:"zKey",fields:[{type:"raw",field:"zKey"}],unique:!1},zSize:{name:"zSize",fields:[{type:"raw",field:"zSize"},{type:"raw",field:"noiseId"}],unique:!0},zDate:{name:"zDate",fields:[{type:"raw",field:"zDate"},{type:"raw",field:"noiseId"}],unique:!0},zConv_zSize:{name:"zConv_zSize",fields:[{type:"raw",field:"zConv"},{type:"raw",field:"zSize"},{type:"raw",field:"noiseId"}],unique:!0},zConv_zDate:{name:"zConv_zDate",fields:[{type:"raw",field:"zConv"},{type:"raw",field:"zDate"},{type:"raw",field:"noiseId"}],unique:!0},zType_zSize:{name:"zType_zSize",fields:[{type:"raw",field:"zType"},{type:"raw",field:"zSize"},{type:"raw",field:"noiseId"}],unique:!0},zType_zDate:{name:"zType_zDate",fields:[{type:"raw",field:"zType"},{type:"raw",field:"zDate"},{type:"raw",field:"noiseId"}],unique:!0}}});o.setAdapterSpecificConfigs(a.a.IDB,{migrations:{58:{version:58,scripts:[{type:"create-table"}]},61:{version:61,scripts:[{type:"create-index",params:{indexName:"zKey"}}]},64:{version:64,scripts:[{type:"create-index",params:{indexName:"zSize"}},{type:"create-index",params:{indexName:"zDate"}},{type:"create-index",params:{indexName:"zConv_zSize"}},{type:"create-index",params:{indexName:"zConv_zDate"}},{type:"create-index",params:{indexName:"zType_zSize"}},{type:"create-index",params:{indexName:"zType_zDate"}}]}}});var l=n("C9Dv"),d=n("mpOJ"),c=n("yi2h");const u=new s.d({tableName:"avatar",name:"Avatar",fields:{userId:{name:"userId",type:a.h.string},url:{name:"url",type:a.h.string},blob:Object(c.a)({name:"blob"},d.a.Blob)},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),p=new s.d({tableName:"ava_history",name:"AvaHistory",fields:{submit_dttm:{name:"submit_dttm",type:a.h.integer},avaBlob:Object(c.a)({name:"avaBlob"},d.a.Blob),orient:{name:"orient",type:a.h.json},size:{name:"size",type:a.h.json},fileName:{name:"fileName",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"submit_dttm"}],unique:!0}}}),m=new s.d({tableName:"board_suggest",name:"BoardSuggest",fields:{groupId:{name:"groupId",type:a.h.string},actionId:{name:"actionId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"groupId"},{type:"raw",field:"actionId"}],unique:!0}}}),h=new s.d({tableName:"catalog_db",name:"CatalogDb",fields:{ownerId:{name:"ownerId",type:a.h.string},isDefault:{name:"isDefault",type:a.h.boolean,default:!1},created_time:{name:"created_time",type:a.h.integer,default:0},catalog_id:{name:"catalog_id",type:a.h.string},catalog_name:{name:"catalog_name",type:a.h.string},version_catalog:{name:"version_catalog",type:a.h.integer,default:0},catalog_photo:{name:"catalog_photo",type:a.h.string,default:""},totalProduct:{name:"totalProduct",type:a.h.integer,default:0},path:{name:"path",type:a.h.string,default:""}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"catalog_id"}],unique:!0}}}),y=new s.d({tableName:"cloud_segment",name:"CloudSegment",fields:{cloudFirstSmsLocalId:{name:"cloudFirstSmsLocalId",type:a.h.string,nullable:!0},cloudSegmentCheck:{name:"cloudSegmentCheck",type:a.h.json,default:[]},cloudSegmentCheckAutoFetch:{name:"cloudSegmentCheckAutoFetch",type:a.h.json,default:[]},conversationId:{name:"conversationId",type:a.h.string},hasMore:{name:"hasMore",type:a.h.integer,default:1},lastCloudVerifiedDttm:{name:"lastCloudVerifiedDttm",type:a.h.integer,nullable:!0},lastDeletedMsgID:{name:"lastDeletedMsgID",type:a.h.integer,nullable:!0},lastGetMaxRecentTs:{name:"lastGetMaxRecentTs",type:a.h.integer,nullable:!0},maxCloudMsgId:{name:"maxCloudMsgId",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"conversationId"}],unique:!0}}});var g=n("4W2c");const f=new s.d({tableName:"conversation",name:"Conversation",fields:{userId:{name:"userId",type:a.h.string},localType:{name:"localType",type:a.h.integer,nullable:!0},outside:{name:"outside",type:a.h.integer,nullable:!0},isGroup:{name:"isGroup",type:a.h.boolean,nullable:!0},firstSmsLocalId:{name:"firstSmsLocalId",type:a.h.string,nullable:!0},respondedByMe:{name:"respondedByMe",type:a.h.boolean,nullable:!0},numMsg:{name:"numMsg",type:a.h.integer,nullable:!0},infoCheckSearch:{name:"infoCheckSearch",type:a.h.json,nullable:!0},syncFromMobile:{name:"syncFromMobile",type:a.h.boolean,nullable:!0},lastActionId:{name:"lastActionId",type:a.h.string,nullable:!0},lastSmsLocalId:{name:"lastSmsLocalId",type:a.h.string,nullable:!0},topOut:{name:"topOut",type:a.h.string,nullable:!0},topOutImprTimeOut:{name:"topOutImprTimeOut",type:a.h.string,nullable:!0},topOutTimeOut:{name:"topOutTimeOut",type:a.h.string,nullable:!0},pinned:{name:"pinned",type:a.h.integer,nullable:!0},label:{name:"label",type:a.h.integer,nullable:!0},preLastSmsLocalId:{name:"preLastSmsLocalId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}},transforms:[new g.a(["previewMessage"])]});f.setAdapterSpecificConfigs(a.a.IDB,{}),f.setAdapterSpecificConfigs(a.a.SQLite,{});const b=new s.d({tableName:"download_retry",name:"DownloadRetry",fields:{url:{name:"url",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"url"}],unique:!0}}}),I=new s.d({tableName:"e2ee_group",name:"E2eeGroup",fields:{id:{name:"id",type:a.h.string},sessions:{name:"sessions",type:a.h.json,nullable:!0},sessionsInfo:{name:"sessionsInfo",type:a.h.json,nullable:!0},enabledGroups:{name:"enabledGroups",type:a.h.json,nullable:!0},refetchedUsers:{name:"refetchedUsers",type:a.h.json,nullable:!0},rqdReinitGroups:{name:"rqdReinitGroups",type:a.h.json,nullable:!0},rqdResetKey:{name:"rqdResetKey",type:a.h.json,nullable:!0},staleUsers:{name:"staleUsers",type:a.h.json,nullable:!0},ts:{name:"ts",type:a.h.integer,nullable:!0},cipherId:{name:"cipherId",type:a.h.string,nullable:!0},resetKeyAt:{name:"resetKeyAt",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}});I.setAdapterSpecificConfigs(a.a.IDB,{migrations:{55:{version:55,scripts:[{type:"create-table"},{type:"add-column",params:{columns:["cipherId","rqdResetKey"]}}]},60:{version:60,scripts:[{type:"add-column",params:{columns:["resetKeyAt"]}}]}}});const v=new s.d({tableName:"e2ee_hash",name:"E2eeHash",fields:{sha256:{name:"sha256",type:a.h.string},ts:{name:"ts",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"sha256"}],unique:!0}}});v.setAdapterSpecificConfigs(a.a.IDB,{migrations:{53:{version:53,scripts:[{type:"create-table"}]}}});const C=new s.d({tableName:"e2ee_identity",name:"E2eeIdentity",fields:{keyId:{name:"keyId",type:a.h.string},keyPair:{name:"keyPair",type:a.h.json},ts:{name:"ts",type:a.h.integer,nullable:!0},regId:{name:"regId",type:a.h.integer,nullable:!0},version:{name:"version",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"keyId"}],unique:!0}}});C.setAdapterSpecificConfigs(a.a.IDB,{migrations:{55:{version:55,scripts:[{type:"create-table"}]}}});const w=new s.d({tableName:"e2ee_meta",name:"E2eeMeta",fields:{identifier:{name:"identifier",type:a.h.string},devices:{name:"devices",type:a.h.json},errorInitAll:{name:"errorInitAll",type:a.h.boolean,nullable:!0},waiting:{name:"waiting",type:a.h.boolean,nullable:!0},upgrading:{name:"upgrading",type:a.h.boolean,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"identifier"}],unique:!0}}}),T=new s.d({tableName:"e2ee_prekey",name:"E2eePrekey",fields:{keyId:{name:"keyId",type:a.h.integer},keyPair:{name:"keyPair",type:a.h.json},ts:{name:"ts",type:a.h.integer,nullable:!0},regId:{name:"regId",type:a.h.integer,nullable:!0},version:{name:"version",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"keyId"}],unique:!0},regId:{name:"regId",fields:[{type:"raw",field:"regId"}],unique:!1}}});T.setAdapterSpecificConfigs(a.a.IDB,{migrations:{55:{version:55,scripts:[{type:"add-column",params:{columns:["ts","regId","version"]}},{type:"create-index",params:{indexName:"regId"}}]}}});const S=new s.d({tableName:"e2ee_session",name:"E2eeSession",fields:{identifier:{name:"identifier",type:a.h.string},record:{name:"record",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"identifier"}],unique:!0}}}),_=new s.d({tableName:"e2ee_signed_prekey",name:"E2eeSignedPrekey",fields:{keyId:{name:"keyId",type:a.h.integer},keyPair:{name:"keyPair",type:a.h.json},ts:{name:"ts",type:a.h.integer,nullable:!0},regId:{name:"regId",type:a.h.integer,nullable:!0},version:{name:"version",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"keyId"}],unique:!0}}});_.setAdapterSpecificConfigs(a.a.IDB,{migrations:{55:{version:55,scripts:[{type:"create-table"}]}}});const M=new s.d({tableName:"file",name:"File",fields:{msgId:{name:"msgId",type:a.h.string},userId:{name:"userId",type:a.h.string},message:{name:"message",type:a.h.json},sendDttm:{name:"sendDttm",type:a.h.integer},fromUid:{name:"fromUid",type:a.h.string,nullable:!0},type:{name:"type",type:a.h.string,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.string,nullable:!0},id:{name:"id",type:a.h.integer,nullable:!0},updateTime:{name:"updateTime",type:a.h.integer,nullable:!0},localPath:{name:"localPath",type:a.h.string,nullable:!0},downloadError:{name:"downloadError",type:a.h.boolean,nullable:!0},folderPath:{name:"folderPath",type:a.h.string,nullable:!0},dimension:{name:"dimension",type:a.h.json,nullable:!0},previewThumb:{name:"previewThumb",nullable:!0,type:a.h.string},ttl:{name:"ttl",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},sendDttm:{name:"sendDttm",fields:[{type:"raw",field:"sendDttm"}],unique:!1},userId_sendDttm_msgId:{name:"userId_sendDttm_msgId",fields:[{type:"raw",field:"userId"},{type:"length",field:"msgId"},{type:"raw",field:"msgId"}],unique:!1}}}),N=new s.d({tableName:"friend",name:"Friend",fields:{userId:{name:"userId",type:a.h.string},username:{name:"username",type:a.h.string,nullable:!0},displayName:{name:"displayName",type:a.h.string},zaloName:{name:"zaloName",type:a.h.string},avatar:{name:"avatar",type:a.h.string},bgavatar:{name:"bgavatar",type:a.h.string,nullable:!0},cover:{name:"cover",type:a.h.string,nullable:!0},gender:{name:"gender",type:a.h.integer,nullable:!0},dob:{name:"dob",type:a.h.integer,default:0},sdob:{name:"sdob",type:a.h.string,default:""},status:{name:"status",type:a.h.string,nullable:!0},phoneNumber:{name:"phoneNumber",type:a.h.string,default:""},isFr:{name:"isFr",type:a.h.integer},isBlocked:{name:"isBlocked",type:a.h.integer,nullable:!0},lastActionTime:{name:"lastActionTime",type:a.h.integer,nullable:!0},lastUpdateTime:{name:"lastUpdateTime",type:a.h.integer,nullable:!0},isActive:{name:"isActive",type:a.h.integer,nullable:!0},key:{name:"key",type:a.h.integer,nullable:!0},type:{name:"type",type:a.h.integer},isActivePC:{name:"isActivePC",type:a.h.integer,nullable:!0},isActiveWeb:{name:"isActiveWeb",type:a.h.integer,nullable:!0},isValid:{name:"isValid",type:a.h.integer,nullable:!0},userKey:{name:"userKey",type:a.h.string,nullable:!0},accountStatus:{name:"accountStatus",type:a.h.integer,nullable:!0},oaInfo:{name:"oaInfo",type:a.h.json,nullable:!0},user_mode:{name:"user_mode",type:a.h.integer,nullable:!0},globalId:{name:"globalId",type:a.h.string,nullable:!0},createdTs:{name:"createdTs",type:a.h.integer,nullable:!0},lastOnlineTime:{name:"lastOnlineTime",type:a.h.integer,nullable:!0},_lastRequestTime:{name:"_lastRequestTime",type:a.h.integer,nullable:!0},bizInfo:{name:"bizInfo",type:a.h.json,nullable:!0},globalNoiseId:{name:"globalNoiseId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),D=new s.d({tableName:"friends_info",name:"FriendsInfo",fields:{userId:{name:"userId",type:a.h.string},username:{name:"username",type:a.h.string,nullable:!0},displayName:{name:"displayName",type:a.h.string},zaloName:{name:"zaloName",type:a.h.string},avatar:{name:"avatar",type:a.h.string},bgavatar:{name:"bgavatar",type:a.h.string,default:""},cover:{name:"cover",type:a.h.string,nullable:!0},gender:{name:"gender",type:a.h.integer,nullable:!0},dob:{name:"dob",type:a.h.integer,default:0},sdob:{name:"sdob",type:a.h.string,default:""},status:{name:"status",type:a.h.string,nullable:!0},phoneNumber:{name:"phoneNumber",type:a.h.string,default:""},isFr:{name:"isFr",type:a.h.integer,default:0},isBlocked:{name:"isBlocked",type:a.h.integer,nullable:!0},lastActionTime:{name:"lastActionTime",type:a.h.integer,nullable:!0},lastUpdateTime:{name:"lastUpdateTime",type:a.h.integer,nullable:!0},isActive:{name:"isActive",type:a.h.integer,nullable:!0},key:{name:"key",type:a.h.integer,nullable:!0},type:{name:"type",type:a.h.integer},isActivePC:{name:"isActivePC",type:a.h.integer,nullable:!0},isActiveWeb:{name:"isActiveWeb",type:a.h.integer,nullable:!0},isValid:{name:"isValid",type:a.h.integer,nullable:!0},userKey:{name:"userKey",type:a.h.string,nullable:!0},accountStatus:{name:"accountStatus",type:a.h.integer,nullable:!0},oaInfo:{name:"oaInfo",type:a.h.json,nullable:!0},user_mode:{name:"user_mode",type:a.h.integer,nullable:!0},globalId:{name:"globalId",type:a.h.string,nullable:!0},createdTs:{name:"createdTs",type:a.h.integer,nullable:!0},lastOnlineTime:{name:"lastOnlineTime",type:a.h.integer,nullable:!0},friendRequestFetchTime:{name:"friendRequestFetchTime",type:a.h.integer,nullable:!0},friendRequestRead:{name:"friendRequestRead",type:a.h.boolean,nullable:!0},_lastRequestTime:{name:"_lastRequestTime",type:a.h.integer,nullable:!0},friendRequestMsg:{name:"friendRequestMsg",type:a.h.string,nullable:!0},friendRequestSource:{name:"friendRequestSource",type:a.h.integer,nullable:!0},friendRequestType:{name:"friendRequestType",type:a.h.integer,nullable:!0},friendRequestSrc:{name:"friendRequestSrc",type:a.h.integer,nullable:!0},friendRequestSortOrder:{name:"friendRequestSortOrder",type:a.h.integer,nullable:!0},userRank:{name:"userRank",type:a.h.string,nullable:!0},bizPkg:{name:"bizPkg",type:a.h.json,nullable:!0},bizInfo:{name:"bizInfo",type:a.h.json,nullable:!0},globalNoiseId:{name:"globalNoiseId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),A=new s.d({tableName:"global_noiseid",name:"GlobalNoiseid",fields:{userId:{name:"userId",type:a.h.string},globalId:{name:"globalId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"globalId"}],unique:!0}}}),E=new s.d({tableName:"group",name:"Group",fields:{desc:{name:"desc",type:a.h.string},type:{name:"type",type:a.h.integer},creatorId:{name:"creatorId",type:a.h.string},totalMember:{name:"totalMember",type:a.h.integer},topMember:{name:"topMember",type:a.h.json},topic:{name:"topic",type:a.h.json,nullable:!0},visibility:{name:"visibility",type:a.h.integer},userId:{name:"userId",type:a.h.string},isGroup:{name:"isGroup",type:a.h.boolean},displayName:{name:"displayName",type:a.h.string},avatar:{name:"avatar",type:a.h.string},bgavatar:{name:"bgavatar",type:a.h.string},authorId:{name:"authorId",type:a.h.string,nullable:!0},lastUpdate:{name:"lastUpdate",type:a.h.integer,nullable:!0},defaultAvatar:{name:"defaultAvatar",type:a.h.boolean,nullable:!0},memberIds:{name:"memberIds",type:a.h.json,nullable:!0},e2ee:{name:"e2ee",type:a.h.integer,nullable:!0},version:{name:"version",type:a.h.string,nullable:!0},subType:{name:"subType",type:a.h.integer,nullable:!0},globalId:{name:"globalId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),j=new s.d({tableName:"group_info",name:"GroupInfo",fields:{memberIds:{name:"memberIds",type:a.h.json},maxMember:{name:"maxMember",type:a.h.integer},setting:{name:"setting",type:a.h.json},lastUpdate:{name:"lastUpdate",type:a.h.integer},topMember:{name:"topMember",type:a.h.json},pendingApproveHintShow:{name:"pendingApproveHintShow",type:a.h.integer,nullable:!0},pendingApproveUsers:{name:"pendingApproveUsers",type:a.h.json,nullable:!0},userId:{name:"userId",type:a.h.string},pendingApprove:{name:"pendingApprove",type:a.h.integer,nullable:!0},adminIds:{name:"adminIds",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"userId"}],unique:!0}}}),O=new s.d({tableName:"group_topics",name:"GroupTopics",fields:{conversationId:{name:"conversationId",type:a.h.string},topics:{name:"topics",type:a.h.json},boardVersion:{name:"boardVersion",type:a.h.integer},lastFetch:{name:"lastFetch",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"conversationId"}],unique:!0}}}),x=new s.d({tableName:"image",name:"Image",fields:{msgId:{name:"msgId",type:a.h.string},userId:{name:"userId",type:a.h.string},message:{name:"message",type:a.h.json},sendDttm:{name:"sendDttm",type:a.h.integer},fromUid:{name:"fromUid",type:a.h.string,nullable:!0},subType:{name:"subType",type:a.h.integer,nullable:!0},type:{name:"type",type:a.h.string,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.string,nullable:!0},localPath:{name:"localPath",type:a.h.string,nullable:!0},id:{name:"id",type:a.h.integer,nullable:!0},previewThumb:{name:"previewThumb",type:a.h.string,nullable:!0},updateTime:{name:"updateTime",type:a.h.integer,nullable:!0},ttl:{name:"ttl",type:a.h.integer},width:{name:"width",type:a.h.integer,nullable:!0},height:{name:"height",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},userId_sendDttm_msgId:{name:"userId_sendDttm_msgId",fields:[{type:"raw",field:"userId"},{type:"length",field:"msgId"},{type:"raw",field:"msgId"}],unique:!1}}}),k=new s.d({tableName:"label",name:"Label",fields:{color:{name:"color",type:a.h.string},createTime:{name:"createTime",type:a.h.integer},emoji:{name:"emoji",type:a.h.string,nullable:!0},id:{name:"id",type:a.h.integer},conversations:{name:"conversations",type:a.h.json},offset:{name:"offset",type:a.h.integer},text:{name:"text",type:a.h.string},textKey:{name:"textKey",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}}),U=new s.d({tableName:"link",name:"Link",fields:{msgId:{name:"msgId",type:a.h.string},userId:{name:"userId",type:a.h.string},message:{name:"message",type:a.h.json},sendDttm:{name:"sendDttm",type:a.h.integer},fromUid:{name:"fromUid",type:a.h.string,nullable:!0},type:{name:"type",type:a.h.string,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.string,nullable:!0},id:{name:"id",type:a.h.integer,nullable:!0},updateTime:{name:"updateTime",type:a.h.integer,nullable:!0},ttl:{name:"ttl",type:a.h.integer},previewThumb:{name:"previewThumb",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},userId_sendDttm_msgId:{name:"userId_sendDttm_msgId",fields:[{type:"raw",field:"userId"},{type:"length",field:"msgId"},{type:"raw",field:"msgId"}],unique:!1}}}),F=new s.d({tableName:"mention",name:"Mention",fields:{msgId:{name:"msgId",type:a.h.integer},userId:{name:"userId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0}}});const B=new s.d({tableName:"message",name:"Message",fields:{msgId:{name:"msgId",type:a.h.string},cliMsgId:{name:"cliMsgId",type:a.h.string},toUid:{name:"toUid",type:a.h.string,nullable:!0},msgType:{name:"msgType",type:a.h.integer},sendDttm:{name:"sendDttm",type:a.h.string},message:{name:"message",type:a.h.json},updateMemberIds:{name:"updateMemberIds",type:a.h.json,nullable:!0},act:{name:"act",type:a.h.string,nullable:!0},action:{name:"action",type:a.h.string,nullable:!0},eventInfo:{name:"eventInfo",type:a.h.json,nullable:!0},src:{name:"src",type:a.h.integer,nullable:!0},status:{name:"status",type:a.h.integer,nullable:!0},notify:{name:"notify",type:a.h.string,nullable:!0},mentions:{name:"mentions",type:a.h.json,nullable:!0},quote:{name:"quote",type:a.h.json,nullable:!0},serverTime:{name:"serverTime",type:a.h.string,nullable:!0},fromUid:{name:"fromUid",type:a.h.string,nullable:!0},dName:{name:"dName",type:a.h.string,nullable:!0},localDttm:{name:"localDttm",type:a.h.integer,nullable:!0},ttl:{name:"ttl",type:a.h.integer,nullable:!0},st:{name:"st",type:a.h.integer,nullable:!0},at:{name:"at",type:a.h.integer,nullable:!0},cmd:{name:"cmd",type:a.h.integer,nullable:!0},originMsgType:{name:"originMsgType",type:a.h.string,nullable:!0},subState:{name:"subState",type:a.h.integer,nullable:!0},e2eeStatus:{name:"e2eeStatus",type:a.h.integer,nullable:!0},sequenseId:{name:"sequenseId",type:a.h.integer,nullable:!0},isLocalMsgId:{name:"isLocalMsgId",type:a.h.boolean,nullable:!0},properties:{name:"properties",type:a.h.json,nullable:!0},originTs:{name:"originTs",type:a.h.string,nullable:!0},subType:{name:"subType",type:a.h.integer,nullable:!0},localPath:{name:"localPath",type:a.h.string,nullable:!0},folderPath:{name:"folderPath",type:a.h.string,nullable:!0},root:{name:"root",type:a.h.integer,nullable:!0},syncFromMobile:{name:"syncFromMobile",type:a.h.boolean,nullable:!0},topOut:{name:"topOut",type:a.h.string,nullable:!0},topOutTimeOut:{name:"topOutTimeOut",type:a.h.string,nullable:!0},topOutImprTimeOut:{name:"topOutImprTimeOut",type:a.h.string,nullable:!0},previewThumb:{name:"previewThumb",type:a.h.string,nullable:!0},refMessageId:{name:"refMessageId",type:a.h.string,nullable:!0},urgency:{name:"urgency",type:a.h.integer,nullable:!0},dimension:{name:"dimension",type:a.h.json,nullable:!0},extra:{name:"extra",type:a.h.json,nullable:!0},_friendRequestData:{name:"_friendRequestData",type:a.h.json,nullable:!0},content:{name:"content",type:a.h.string,nullable:!0},isErrorInfo:{name:"isErrorInfo",type:a.h.boolean,nullable:!0},hasReact:{name:"hasReact",type:a.h.boolean,nullable:!0},uidSenderDel:{name:"uidSenderDel",type:a.h.string,nullable:!0},footer:{name:"footer",type:a.h.json,nullable:!0},sendErrorCode:{name:"sendErrorCode",type:a.h.integer,nullable:!0},__isUpdateMessage:{name:"__isUpdateMessage",type:a.h.boolean,nullable:!0},__updateData:{name:"__updateData",type:a.h.json,nullable:!0},width:{name:"width",type:a.h.integer,nullable:!0},height:{name:"height",type:a.h.integer,nullable:!0},zipKey:{name:"zipKey",type:a.h.string,nullable:!0},resend:{name:"resend",type:a.h.json,nullable:!0},forwardFail:{name:"forwardFail",type:a.h.string,nullable:!0},cancelled:{name:"cancelled",type:a.h.boolean,nullable:!0},z_parsedTokens:{name:"z_parsedTokens",type:a.h.json,nullable:!0},isLastMsg:{name:"isLastMsg",type:a.h.boolean,nullable:!0},isSelected:{name:"isSelected",type:a.h.boolean,nullable:!0},textArguments:{name:"textArguments",type:a.h.json,nullable:!0},msgText:{name:"msgText",type:a.h.string,nullable:!0},actionText:{name:"actionText",type:a.h.string,nullable:!0},platformType:{name:"platformType",type:a.h.integer,nullable:!0},oldMsgId:{name:"oldMsgId",type:a.h.string,nullable:!0},vOrient:{name:"vOrient",type:a.h.integer,nullable:!0},fileSize:{name:"fileSize",type:a.h.integer,nullable:!0},upSrc:{name:"upSrc",type:a.h.integer,nullable:!0},reader:{name:"reader",type:a.h.integer,nullable:!0},sequenceId:{name:"sequenceId",type:a.h.integer,nullable:!0},staredDttm:{name:"staredDttm",type:a.h.integer,nullable:!0},reference:{name:"reference",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},userId_sendDttm_msgId:{name:"userId_sendDttm_msgId",fields:[{type:"raw",field:"toUid"},{type:"raw",field:"sendDttm"},{type:"raw",field:"msgId"}],unique:!0},cliMsgIdIndex:{name:"cliMsgIdIndex",table:!0,fields:[{type:"raw",field:"cliMsgId"}],unique:!1},status_sendDttm:{name:"status_sendDttm",table:!0,fields:[{type:"raw",field:"status"},{type:"raw",field:"sendDttm"}],unique:!1}},transforms:[new g.a(["message"])]});B.setAdapterSpecificConfigs(a.a.IDB,{}),B.setAdapterSpecificConfigs(a.a.SQLite,{partitionField:"toUid",corruptionImpact:a.b.IMPACT_PARTIAL});const L=new s.d({tableName:"notifications",name:"Notifications",fields:{type:{name:"type",type:a.h.integer},uid:{name:"uid",type:a.h.string},ts:{name:"ts",type:a.h.integer},toUid:{name:"toUid",type:a.h.string,nullable:!0},msgId:{name:"msgId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"ts"}],unique:!0}}}),q=new s.d({tableName:"poll",name:"Poll",fields:{group_id:{name:"group_id",type:a.h.string,nullable:!0},updater:{name:"updater",type:a.h.string,nullable:!0},creator:{name:"creator",type:a.h.string},question:{name:"question",type:a.h.string},options:{name:"options",type:a.h.json},joined:{name:"joined",type:a.h.boolean},closed:{name:"closed",type:a.h.boolean},poll_id:{name:"poll_id",type:a.h.integer},allow_multi_choices:{name:"allow_multi_choices",type:a.h.boolean},allow_add_new_option:{name:"allow_add_new_option",type:a.h.boolean},is_anonymous:{name:"is_anonymous",type:a.h.boolean},poll_type:{name:"poll_type",type:a.h.integer},created_time:{name:"created_time",type:a.h.integer},updated_time:{name:"updated_time",type:a.h.integer},expired_time:{name:"expired_time",type:a.h.integer},is_hide_vote_preview:{name:"is_hide_vote_preview",type:a.h.boolean,nullable:!0},poll_version:{name:"poll_version",type:a.h.integer,nullable:!0},msgId:{name:"msgId",type:a.h.string,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.string,nullable:!0},id:{name:"id",type:a.h.integer,nullable:!0},num_vote:{name:"num_vote",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"poll_id"}],unique:!0}}}),R=new s.d({tableName:"preview_message",name:"PreviewMsg",fields:{convId:{name:"convId",type:a.h.string},msgId:{name:"msgId",type:a.h.string},dName:{name:"dName",type:a.h.string},message:{name:"message",type:a.h.json},messageType:{name:"messageType",type:a.h.json},messageTime:{name:"messageTime",type:a.h.string},isGroup:{name:"isGroup",type:a.h.boolean},fromUid:{name:"fromUid",type:a.h.string,nullable:!0},toUid:{name:"toUid",type:a.h.string,nullable:!0},urgencyLevel:{name:"urgencyLevel",type:a.h.integer,nullable:!0},properties:{name:"properties",type:a.h.json,nullable:!0},mentions:{name:"mentions",type:a.h.json,nullable:!0},ttl:{name:"ttl",type:a.h.integer,nullable:!0},cliMsgId:{name:"cliMsgId",type:a.h.string,nullable:!0},status:{name:"status",type:a.h.integer},substate:{name:"substate",type:a.h.integer,nullable:!0},computedMessage:{name:"computedMessage",type:a.h.string,nullable:!0},computedIcon:{name:"computedIcon",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"convId"}],unique:!0},userId_sendDttm_msgId:{name:"messageTime",fields:[{type:"raw",field:"messageTime"}],unique:!1}},transforms:[new g.a(["message"])]});R.setAdapterSpecificConfigs(a.a.IDB,{migrations:{52:{version:52,scripts:[{type:"create-table"}]}}}),R.setAdapterSpecificConfigs(a.a.SQLite,{});const P=new s.d({tableName:"product_db",name:"ProductDb",fields:{price:{name:"price",type:a.h.string},description:{name:"description",type:a.h.string},product_id:{name:"product_id",type:a.h.string},product_name:{name:"product_name",type:a.h.string},currency_unit:{name:"currency_unit",type:a.h.string},product_photos:{name:"product_photos",type:a.h.json},create_time:{name:"create_time",type:a.h.integer},catalog_id:{name:"catalog_id",type:a.h.string},owner_id:{name:"owner_id",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"product_id"}],unique:!0}}}),K=new s.d({tableName:"quick_message",name:"QuickMessage",fields:{id:{name:"id",type:a.h.integer},keyword:{name:"keyword",type:a.h.string},type:{name:"type",type:a.h.integer},createdTime:{name:"createdTime",type:a.h.integer},lastModified:{name:"lastModified",type:a.h.integer},message:{name:"message",type:a.h.json},media:{name:"media",type:a.h.json,nullable:!0},version:{name:"version",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}},transforms:[new g.a(["message","media"])]});K.setAdapterSpecificConfigs(a.a.IDB,{}),K.setAdapterSpecificConfigs(a.a.SQLite,{});const V=new s.d({tableName:"star_message",name:"StarMessage",fields:{msgId:{name:"msgId",type:a.h.string},userId:{name:"userId",type:a.h.string},staredDttm:{name:"staredDttm",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},staredDttm:{name:"staredDttm",fields:[{type:"raw",field:"staredDttm"}],unique:!1}}}),z=new s.d({tableName:"sticker",name:"Sticker",fields:{id:{name:"id",type:a.h.integer},cateId:{name:"cateId",type:a.h.integer},type:{name:"type",type:a.h.integer},text:{name:"text",type:a.h.string},uri:{name:"uri",type:a.h.string},fkey:{name:"fkey",type:a.h.integer},status:{name:"status",type:a.h.integer},stickerUrl:{name:"stickerUrl",type:a.h.string},stickerSpriteUrl:{name:"stickerSpriteUrl",type:a.h.string},stickerWebpUrl:{name:"stickerWebpUrl",type:a.h.string,nullable:!0},totalFrames:{name:"totalFrames",type:a.h.integer},duration:{name:"duration",type:a.h.integer},effectId:{name:"effectId",type:a.h.integer},checksum:{name:"checksum",type:a.h.string,nullable:!0},ext:{name:"ext",type:a.h.integer,nullable:!0},source:{name:"source",type:a.h.integer,nullable:!0},fss:{name:"fss",type:a.h.string,nullable:!0},fssInfo:{name:"fssInfo",type:a.h.string,nullable:!0},version:{name:"version",type:a.h.integer,nullable:!0},extInfo:{name:"extInfo",type:a.h.json,nullable:!0},fetchTs:{name:"fetchTs",type:a.h.integer},updateState:{name:"updateState",type:a.h.integer,nullable:!0},recentItemType:{name:"recentItemType",type:a.h.string,nullable:!0},recentItemId:{name:"recentItemId",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"cateId"},{type:"raw",field:"id"}],unique:!0}}}),Q=new s.d({tableName:"todo",name:"Todo",fields:{id:{name:"id",type:a.h.string},creator:{name:"creator",type:a.h.string},updateTime:{name:"updateTime",type:a.h.integer},createTime:{name:"createTime",type:a.h.integer},assignees:{name:"assignees",type:a.h.json},dueDate:{name:"dueDate",type:a.h.integer},content:{name:"content",type:a.h.string},description:{name:"description",type:a.h.string},extra:{name:"extra",type:a.h.json},dateDefaultType:{name:"dateDefaultType",type:a.h.integer},status:{name:"status",type:a.h.integer},watchers:{name:"watchers",type:a.h.json},personalBoardType:{name:"personalBoardType",type:a.h.integer},dingTimes:{name:"dingTimes",type:a.h.integer,nullable:!0},schedule:{name:"schedule",type:a.h.json,nullable:!0},attach:{name:"attach",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}}),G=new s.d({tableName:"topic_v2",name:"Topic",fields:{editorId:{name:"editorId",type:a.h.string,nullable:!0},emoji:{name:"emoji",type:a.h.string},color:{name:"color",type:a.h.integer},groupId:{name:"groupId",type:a.h.string},creatorId:{name:"creatorId",type:a.h.string,nullable:!0},editTime:{name:"editTime",type:a.h.integer},eventType:{name:"eventType",type:a.h.integer,nullable:!0},responseMem:{name:"responseMem",type:a.h.json,nullable:!0},params:{name:"params",type:a.h.json},type:{name:"type",type:a.h.integer},duration:{name:"duration",type:a.h.integer,nullable:!0},repeatData:{name:"repeatData",type:a.h.json,nullable:!0},createTime:{name:"createTime",type:a.h.integer},repeat:{name:"repeat",type:a.h.integer},startTime:{name:"startTime",type:a.h.integer},id:{name:"id",type:a.h.string},action:{name:"action",type:a.h.integer,nullable:!0},listRespMem:{name:"listRespMem",type:a.h.json,nullable:!0},creatorUid:{name:"creatorUid",type:a.h.string,nullable:!0},toUid:{name:"toUid",type:a.h.string,nullable:!0},editorUid:{name:"editorUid",type:a.h.string,nullable:!0},repeatInfo:{name:"repeatInfo",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"groupId"},{type:"raw",field:"id"}],unique:!0}}}),H=new s.d({tableName:"ttlmsg",name:"TTLMessage",fields:{globalDelMsgId:{name:"globalDelMsgId",type:a.h.string},ts:{name:"ts",type:a.h.string},expired:{name:"expired",type:a.h.integer},type:{name:"type",type:a.h.integer},conversationId:{name:"conversationId",type:a.h.string},clientDelMsgId:{name:"clientDelMsgId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"globalDelMsgId"}],unique:!0},expired:{name:"expired",fields:[{type:"raw",field:"expired"}],unique:!1}}}),$=new s.d({tableName:"unread_conv",name:"UnreadConv",fields:{convId:{name:"convId",type:a.h.string},smsUnreadCount:{name:"smsUnreadCount",type:a.h.integer},smsUnreadNotCount:{name:"smsUnreadNotCount",type:a.h.integer},mentionUnreadCount:{name:"mentionUnreadCount",type:a.h.integer},strangerUnreadCount:{name:"strangerUnreadCount",type:a.h.integer},lastProcessMsgId:{name:"lastProcessMsgId",type:a.h.string},lastSeenReactId:{name:"lastSeenReactId",type:a.h.string},unreadMark:{name:"unreadMark",type:a.h.json,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"convId"}],unique:!0},userId_sendDttm_msgId:{name:"lastProcessMsgId",fields:[{type:"raw",field:"lastProcessMsgId"}],unique:!1}}});$.setAdapterSpecificConfigs(a.a.IDB,{migrations:{52:{version:52,scripts:[{type:"create-table"}]}}});const J=new s.d({tableName:"uploaded_file_thumb",name:"UploadFileThumb",fields:{checksum:{name:"checksum",type:a.h.string},url:{name:"url",type:a.h.string},dimension:{name:"dimension",type:a.h.json}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"checksum"}],unique:!0}}});new s.d({tableName:"zinstant_db",name:"ZInstant",fields:{data:{name:"data",type:a.h.string},modify_time:{name:"modify_time",type:a.h.integer},key:{name:"key",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}}).setAdapterSpecificConfigs(a.a.IDB,{migrations:{60:{version:60,scripts:[{type:"create-table"}]}}});const Y=new s.d({tableName:"e2ee_deciphered",name:"E2eeDeciphered",fields:{key:{name:"key",type:a.h.string},content:{name:"content",type:a.h.string},ts:{name:"ts",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}});Y.setAdapterSpecificConfigs(a.a.IDB,{migrations:{63:{version:63,scripts:[{type:"create-table"}]}}});const Z=new s.d({tableName:"temp_blob",name:"TempBlob",fields:{clientId:{name:"clientId",type:a.h.integer},data:Object(c.a)({name:"data"},d.a.Blob)},indices:{primary:{name:"primary",fields:[{type:"raw",field:"clientId"}],unique:!0}}});Z.setAdapterSpecificConfigs(a.a.IDB,{migrations:{65:{version:65,scripts:[{type:"create-table"}]}}}),Z.setAdapterSpecificConfigs(a.a.SQLite,{});const W={Avatar:u,AvaHistory:p,BoardSuggest:m,CloudSegment:y,Conversation:f,DownloadRetry:b,File:M,Friend:N,FriendsInfo:D,Group:E,GroupInfo:j,GroupTopics:O,Image:x,Label:k,Link:U,Mention:F,Message:B,Notifications:L,Poll:q,StarMessage:V,Sticker:z,Todo:Q,Topic:G,TTLMessage:H,E2eeMeta:w,E2eePrekey:T,E2eeSession:S,E2eeIdentity:C,E2eeSignedPrekey:_,E2eeGroup:I,E2eeHash:v,E2eeDeciphered:Y,QuickMessage:K,GlobalNoiseid:A,UploadFileThumb:J,ProductDb:P,CatalogDb:h,PreviewMsg:R,UnreadConv:$,ZCloud:o};W.TempBlob=Z;const X={name:"Core",session:!0},ee={partitionNamingStrategy:[r.a.byUser(),r.a.const("Core")],partitionsMap:Object(l.a)(W)},te={partitionNamingStrategy:[r.a.const("zdb"),r.a.byUser()],partitionsMap:Object(l.a)(W)},ne=Object(i.a)(Object(i.a)(Object(i.a)({},X),ee),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_FULL}),ie=Object(i.a)(Object(i.a)(Object(i.a)({},X),te),{},{version:65,milestoneVersion:51,type:a.a.IDB});let ae=null,re=null;t.a={baseConfig:X,schema:W,get useSqlite(){return null===ae&&(ae=new s.a(ne)),ae},get useIdb(){return null===re&&(re=new s.a(ie)),re}}},ohhZ:function(e,t,n){},pAGP:function(e,t,n){"use strict";n.d(t,"b",(function(){return i.d})),n.d(t,"a",(function(){return a.a}));n("x9oK"),n("UJ0r"),n("3wcW"),n("X2RP"),n("6Cx8");var i=n("teaq"),a=(n("tHMN"),n("ipeT"),n("PhBv"),n("d/or"));n("LzQZ")},pP8i:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv"),l=n("pAGP");const d=new l.b({tableName:"metas",name:"Metas",fields:{id:{name:"id",type:a.h.integer},current:{name:"current",type:a.h.integer,default:0},startups:{name:"startups",type:a.h.json,default:[],nullable:!0},currentPage:{name:"currentPage",type:a.h.integer,default:0},ss:{name:"ss",type:a.h.integer,default:-1},ss_ln:{name:"ss_ln",type:a.h.integer,default:-1}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}});var c=n("fsQs");const u=new l.b({tableName:"modules",name:"Modules",fields:{id:{name:"id",type:a.h.integer},hash:{name:"hash",type:a.h.string},encver:{name:"encver",type:a.h.integer,default:c.u}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"hash"}],unique:!0}}});var p=n("mpOJ"),m=n("yi2h");const h={Pages:new l.b({tableName:"pages",name:"Pages",fields:{id:{name:"id",type:a.h.integer},mtime:{name:"mtime",type:a.h.integer},data:Object(m.a)({name:"data",nullable:!0},p.a.Blob),curoffs:{name:"curoffs",type:a.h.integer,default:0},max:{name:"max",type:a.h.integer,default:250*c.i}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}}),Metas:d,Modules:u},y={name:"ZLog",session:!1},g={partitionNamingStrategy:[r.a.const("ZLog")],partitionsMap:Object(o.a)(h)},f={partitionNamingStrategy:[r.a.const("zdb_log")],partitionsMap:Object(o.a)(h)},b=Object(i.a)(Object(i.a)(Object(i.a)({},y),g),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_PARTIAL}),I=Object(i.a)(Object(i.a)(Object(i.a)({},y),f),{},{version:1,milestoneVersion:1,type:a.a.IDB});let v=null,C=null;t.a={baseConfig:y,schema:h,get useSqlite(){return null===v&&(v=new s.a(b)),v},get useIdb(){return null===C&&(C=new s.a(I)),C}}},pRxM:function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv"),l=n("mpOJ"),d=n("yi2h");const c={EffectRes:new s.d({tableName:"effect_res",name:"EffectRes",fields:{icon:{name:"icon",type:a.h.string},iconBlob:Object(d.a)({name:"iconBlob"},l.a.Blob),genDate:{name:"genDate",type:a.h.integer}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"icon"}],unique:!0}}}),LiveEmoji:new s.d({tableName:"live_emoji",name:"LiveEmoji",fields:{rType:{name:"rType",type:a.h.integer},rIcon:{name:"rIcon",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"rType"}],unique:!0}}}),Reaction:new s.d({tableName:"reaction",name:"Reaction",fields:{idTo:{name:"idTo",type:a.h.string},msgType:{name:"msgType",type:a.h.string},rClientMsgId:{name:"rClientMsgId",type:a.h.integer},rMsgId:{name:"rMsgId",type:a.h.string},rMsgType:{name:"rMsgType",type:a.h.integer,nullable:!0},currentIcon:{name:"currentIcon",type:a.h.integer},reactions:{name:"reactions",type:a.h.json,nullable:!0},lastSender:{name:"lastSender",type:a.h.string,nullable:!0},lastUpdate:{name:"lastUpdate",type:a.h.integer,nullable:!0},lastReceiveReactId:{name:"lastReceiveReactId",type:a.h.integer,nullable:!0},lastReactIcon:{name:"lastReactIcon",type:a.h.integer,nullable:!0},ts:{name:"ts",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"rMsgId"}],unique:!0}}}),UnreadReact:new s.d({tableName:"unread_react",name:"UnreadReact",fields:{userId:{name:"userId",type:a.h.string},conversationId:{name:"conversationId",type:a.h.string},msgId:{name:"msgId",type:a.h.string},reactIcon:{name:"reactIcon",type:a.h.string},reactionId:{name:"reactionId",type:a.h.string},reactionCliId:{name:"reactionCliId",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"conversationId"}],unique:!0}}})},u={name:"Reaction",session:!0},p={partitionNamingStrategy:[r.a.byUser(),r.a.const("Reaction")],partitionsMap:Object(o.a)(c)},m={partitionNamingStrategy:[r.a.const("r_db"),r.a.byUser()],partitionsMap:Object(o.a)(c)},h=Object(i.a)(Object(i.a)(Object(i.a)({},u),p),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_FULL}),y=Object(i.a)(Object(i.a)(Object(i.a)({},u),m),{},{version:4,milestoneVersion:4,type:a.a.IDB});let g=null,f=null;t.a={baseConfig:u,schema:c,get useSqlite(){return null===g&&(g=new s.a(h)),g},get useIdb(){return null===f&&(f=new s.a(y)),f}}},pjo1:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("jDHv");const a=Object(i.define)("database-client")},"rdC+":function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv");const l={AsyncStore:new s.d({tableName:"async-store",name:"AsyncStore",fields:{key:{name:"key",type:a.h.string},val:{name:"val",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"key"}],unique:!0}}})},d={name:"SecureLocalstorage",session:!1},c={partitionNamingStrategy:[r.a.const("SecureLocalstorage")],partitionsMap:Object(o.a)(l)},u={partitionNamingStrategy:[r.a.const("zsecure-localstorage")],partitionsMap:Object(o.a)(l)},p=Object(i.a)(Object(i.a)(Object(i.a)({},d),c),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_PARTIAL}),m=Object(i.a)(Object(i.a)(Object(i.a)({},d),u),{},{version:2,milestoneVersion:1,type:a.a.IDB});let h=null,y=null;t.a={baseConfig:d,schema:l,get useSqlite(){return null===h&&(h=new s.a(p)),h},get useIdb(){return null===y&&(y=new s.a(m)),y}}},tHMN:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var i=n("jDHv"),a=n("AH6j");n("PmZf");class r extends a.b{}const s=Object(i.define)("database-engine")},teaq:function(e,t,n){"use strict";n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return b})),n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return v}));var i=n("VTBJ"),a=n("75pU"),r=n.n(a),s=n("jDHv"),o=n("UK4g"),l=n("YEoC"),d=n("DI/x"),c=n("xI/L");class u{constructor(e){this._config=e,this.name=void 0,this.nullable=void 0,this.escapedName=void 0,this.type=void 0,this.jsType=void 0,this.autoIncrement=void 0,this.defaultValue=void 0,this.name=e.name,this.nullable=!0===e.nullable,this.escapedName='"'+this.name+'"',this.type=e.type,this.jsType=this.getJsType(),this.autoIncrement=e.autoIncrement,this.defaultValue=e.default}getJsType(){switch(this._config.type){case l.h.blob:return"object";case l.h.boolean:return"boolean";case l.h.float:case l.h.integer:return"number";case l.h.json:return"object";case l.h.string:default:return"string"}}}class p extends u{constructor(e){super(e),this.jsBinaryType=void 0,this.jsBinaryType=e.jsBinaryType}static isBinaryFieldConfig(e){return void 0!==e.jsBinaryType}}class m{}class h extends m{constructor(e){super(),this.fieldConfigs=void 0,this.fieldConfigs=Object.values(e).map((e=>p.isBinaryFieldConfig(e)?new p(e):new u(e)))}getFieldType(e){for(const t of this.fieldConfigs)if(t.name===e)return t.type;return null}getFields(e){return e?this.fieldConfigs.filter((t=>t.type===e)):this.fieldConfigs}getFieldValues(e){return this.getFields().filter((e=>!e.autoIncrement)).map((t=>e[t.name]))}createValidator(e){const t=this.getFields().filter((e=>!e.autoIncrement)),n=e?t.filter((t=>e.includes(t.name))):t,i=JSON.stringify(t.map((e=>e.name))),a=n.map((e=>e.type===l.h.json?e.nullable||void 0!==e.defaultValue?"":`if (v[${e.escapedName}] === null || v[${e.escapedName}] === undefined) return { ok: false, reason: 1, field: ${e.escapedName}, expected: "object - non-nullable", actual: v[${e.escapedName}] }`:e.nullable?["if (",`v[${e.escapedName}] !== null &&`,`v[${e.escapedName}] !== undefined &&`,`typeof v[${e.escapedName}] !== "${e.jsType}")`,`return { ok: false, reason: 2, field: ${e.escapedName}, expected: "${e.jsType} - nullable", actual: typeof v[${e.escapedName}] }`].join(""):[`if (v[${e.escapedName}] === null || v[${e.escapedName}] === undefined) return ${void 0!==e.defaultValue?"{ ok: true }":`{ ok: false, reason: 1, field: ${e.escapedName}, expected: "non-nullable", actual: typeof v[${e.escapedName}] }`};`,`if (typeof v[${e.escapedName}] !== "${e.jsType}") return { ok: false, reason: 2, field: ${e.escapedName}, expected: "${e.jsType}", actual: typeof v[${e.escapedName}] }`].join(";")));a.push(`const vldFls = ${i}`,"const curFlds = Object.keys(v)","for (const field of curFlds) { if (!vldFls.includes(field)) return { ok: false, reason: 3, field }}");const r=a.join(";").concat(";return { ok: true };");return new Function("v",r)}createFullEntityValidator(e){const t=this.getFields().filter((e=>!e.autoIncrement)),n=e?t.filter((t=>e.includes(t.name))):t,i=JSON.stringify(t.map((e=>e.name)));return function(e){const t=[];n.forEach((n=>{if(n.type===l.h.json){if(n.nullable||void 0!==n.defaultValue)return;null!==e[n.name]&&void 0!==e[n.name]||t.push({ok:!1,reason:1,field:n.name,expected:"object - non-nullable",actual:typeof e[n.name]})}else n.nullable?null!==e[n.name]&&void 0!==e[n.name]&&typeof e[n.name]!==n.jsType&&t.push({ok:!1,reason:2,field:n.name,expected:`${n.jsType} - nullable`,actual:typeof e[n.name]}):null===e[n.name]||void 0===e[n.name]&&null==n.defaultValue?t.push({ok:!1,reason:1,field:n.name,expected:"non-nullable",actual:typeof e[n.name]}):typeof e[n.name]!==n.jsType&&t.push({ok:!1,reason:2,field:n.name,expected:n.jsType,actual:typeof e[n.name]})}));const a=i,r=Object.keys(e);for(const n of r)a.includes(n)||t.push({ok:!1,reason:3,field:n});return t.length||t.push({ok:!0}),t}}}class y extends m{getFieldType(e){throw new Error("Non-field like entity doesn't support get field type")}constructor(e){super(),this.fieldConfig=void 0,this.fieldConfig=new u(Object(i.a)({name:"data"},e))}getFieldValues(e){return[e]}createValidator(){const e=this.fieldConfig;let t=`const v = { ${e.escapedName}: x };`;return e.type===l.h.json?e.nullable||void 0!==e.defaultValue?t="":t+=`if (v[${e.escapedName}] === null || v[${e.escapedName}] === undefined) return { ok: false, reason: 1, field: ${e.escapedName}, expected: "object - non-nullable", actual: v[${e.escapedName}] }`:e.nullable?t+=["if (",`v[${e.escapedName}] !== null &&`,`v[${e.escapedName}] !== undefined &&`,`typeof v[${e.escapedName}] !== "${e.jsType}")`,`return { ok: false, reason: 2, field: ${e.escapedName}, expected: "${e.jsType} - nullable", actual: typeof v[${e.escapedName}] }`].join(""):t+=[`if (v[${e.escapedName}] === null || v[${e.escapedName}] === undefined) return ${void 0!==e.defaultValue?"{ ok: true }":`{ ok: false, reason: 1, field: ${e.escapedName}, expected: "non-nullable", actual: v[${e.escapedName}] }`};`,`if (typeof v[${e.escapedName}] !== "${e.jsType}") return { ok: false, reason: 2, field: ${e.escapedName}, expected: "${e.jsType}", actual: typeof v[${e.escapedName}] }`].join(";"),t=t.concat(";return { ok: true };"),new Function("x",t)}createFullEntityValidator(e){throw new Error("Method not implemented.")}getFields(e){return e?this.fieldConfig.type===e?[this.fieldConfig]:[]:[this.fieldConfig]}}class g{constructor(e){this._config=e}get name(){return this._config.name}get fields(){return this._config.fields}get unique(){return this._config.unique}get autoIncrement(){return this._config.autoIncrement}getRealFields(){return this._config.fields.filter((e=>"raw"===e.type)).map((e=>e.field))}createKey(e){return this.getRealFields().map((t=>e[t]))}getValue(e,t){if(Array.isArray(e)){return e[this._config.fields.findIndex((e=>e.field===t))]}if(1===this._config.fields.length&&this._config.fields[0].field===t)return e}validateKey(e){let t=!0;return t=Array.isArray(e)?this._config.fields.length===e.length:null!=e&&1===this._config.fields.length,t}}class f{constructor(e){this.commonConfig=e,this.entity=void 0,this.isNonFieldlikeEntity=void 0,this.fieldManager=void 0,this.indices=void 0,this.tableName=void 0,this.name=void 0,this.primaryIndex=void 0,this.mapNameToIndices=void 0,this.validators=void 0,this.fullEntityValidators=void 0,this.adapterSpecificConfigs=null,this.dbName=void 0,this.isNonFieldlikeEntity=e.isNonFieldlikeEntity||!1,this.indices=Object.values(e.indices).map((e=>new g(e)));let t=e.fields;if(!this.isNonFieldlikeEntity){const n=new Set;this.indices.forEach((e=>{if(e.autoIncrement){e.fields.forEach((({field:e})=>{n.add(e)}))}})),n.size&&(t=Object.entries(e.fields).reduce(((e,[t,a])=>{const r=Object(i.a)({},a);return n.has(r.name)&&(r.autoIncrement=!0),e[t]=r,e}),{}))}this.fieldManager=this.createConfigFieldManager(t),this.mapNameToIndices=new Map(this.indices.map((e=>[e.name,e]))),this.primaryIndex=this.getPrimaryIndex()||null,this.name=e.name,this.tableName=e.tableName,this.validators=new Map,this.fullEntityValidators=new Map,this.getIndexPartitionField=r()(this.getIndexPartitionField.bind(this)),this.getRawConfigByAdapterType=r()(this.getRawConfigByAdapterType.bind(this))}hasBlobField(){return!this.isNonFieldlikeEntity&&this.fieldManager.getFields().some((e=>e.type===l.h.blob))}getFieldType(e){return this.fieldManager.getFieldType(e)}doesUsePartitionTable(e){if(void 0!==this.commonConfig.partitionField||this.doesHavePartitionByField(e)){if(this.isNonFieldlikeEntity)return!1;const t=this.commonConfig.partitionField||this.getPartitionField(e);return-1===this.primaryIndex.fields.findIndex((e=>e.field===t))}return!1}doesHavePartitionByField(e){return!this.isNonFieldlikeEntity&&!!this.getRawConfigByAdapterType(e,"partitionField")}getTransformConfigs(e){return this.getRawConfigByAdapterType(e,"transforms")||[]}getPartitionField(e){var t;return null===(t=this.getRawConfigByAdapterType(e,"partitionField"))||void 0===t?void 0:t.toString()}getCorruptionImpact(e){var t;return null===(t=this.getRawConfigByAdapterType(e,"corruptionImpact"))||void 0===t?void 0:t.toString()}getMigrationInfos(e){return this.getRawConfigByAdapterType(e,"migrations")||{}}createConfigFieldManager(e){return this.isNonFieldlikeEntity?new y(e):new h(e)}getPrimaryIndex(){if(!this.mapNameToIndices.has("primary")&&!this.isNonFieldlikeEntity)throw new d.w("primary");return this.mapNameToIndices.get("primary")}getIndex(e){const t=this.mapNameToIndices.get(e);if(!t)throw new d.w(e);return t}getIndexPartitionField(e,t){return this.getIndex(t).getRealFields().indexOf(this.getPartitionField(e))}validateFields(e,t){if(o.c){return this.getValidator(t)(e)}return{ok:!0}}validate(e,t=!0){const n=t||this.isNonFieldlikeEntity?void 0:Object.keys(e).sort(),i=this.validateFields(e,n);let a=null;if(!1===i.ok)switch(i.reason){case 1:a=new d.o(`'${i.field}' field is missing!`);break;case 2:a=new d.o(`'${i.field}' field has invalid data type - Expected: ${i.expected} - Actual: ${i.actual}`);break;case 3:a=new d.o(`'${i.field}' field is unknown!`)}if(a)throw a}getValidator(e){const t=e?e.join("-"):"all_fields";if(!this.validators.get(t)){const n=this.fieldManager.createValidator(e);this.validators.set(t,n)}return this.validators.get(t)}validateFullEntity(e){return this.getFullEntityValidator()(e)}getFullEntityValidator(e){const t=e?e.join("-"):"all_fields";if(!this.fullEntityValidators.get(t)){const n=this.fieldManager.createFullEntityValidator(e);this.fullEntityValidators.set(t,n)}return this.fullEntityValidators.get(t)}getFieldValues(e){return this.fieldManager.getFieldValues(e)}getFields(){return this.fieldManager.getFields()}prepareValue(e,t,n){if(!t)return e;const a=this.getFields().filter((e=>void 0!==e.defaultValue));if(0===a.length)return e;if(n){if(void 0!==e)return e;const{defaultValue:t}=a[0];return"function"==typeof t?t():t}{const t=Object(i.a)({},e);return a.forEach((({name:e,defaultValue:n})=>{if(void 0===t[e]){const i="function"==typeof n?n():n;t[e]=i}})),t}}getRawConfigByAdapterType(e,t){if(null===this.adapterSpecificConfigs)return this.commonConfig[t];const n=this.adapterSpecificConfigs.get(e);if(void 0===n)return this.commonConfig[t];{let e=n[t];return void 0===e?this.commonConfig[t]:e}}setAdapterSpecificConfigs(e,t){null===this.adapterSpecificConfigs&&(this.adapterSpecificConfigs=new Map);const[n,i]=this.validateConfig(e,t);if(n)throw n;this.adapterSpecificConfigs.set(e,i)}validateConfig(e,t){return e===l.a.SQLite&&t.partitionField&&void 0===t.corruptionImpact?[new d.s(this.name),null]:[null,t]}}class b{constructor(e,t,n,i,a,r,s,o){this.database=e,this.type=t,this.name=n,this.sessional=i,this.version=a,this.milestoneVersion=r,this.cipherKey=s,this.tablesMap=void 0,this.tables=void 0,this.tablesMap=new Map(o.tables.map((e=>[e.name,e]))),this.tables=o.tables,this.tables.forEach((t=>{t.dbName=e}))}getTableConfig(e){return this.tablesMap.get(e)}}class I{get isSqlite(){return this.type===l.a.SQLite}get isIDB(){return this.type===l.a.IDB}get typeName(){return this.type===l.a.IDB?"idb":"sql"}constructor(e){this.partitionsConfigCache=void 0,this.name=void 0,this.version=void 0,this.milestoneVersion=void 0,this.session=void 0,this.available=void 0,this.type=void 0,this.tables=void 0,this.partitionsMap=void 0,this.partitionNamingStrategy=void 0,this.partitionStrategies=void 0,this.supportPartitionByField=void 0,this.corruptionImpact=void 0,this.partitionedTables=[],this.hasPartitionedTables=void 0;const[t,n]=this.validateConfig(e);if(t)throw t;this.name=n.name,this.session=n.session,this.version=n.version,this.milestoneVersion=n.milestoneVersion,this.type=n.type,this.partitionsMap=n.partitionsMap,this.partitionNamingStrategy=n.partitionNamingStrategy,this.partitionStrategies=n.partitionStrategies||[],this.supportPartitionByField=n.type===l.a.SQLite,this.corruptionImpact=n.corruptionImpact,this.available=!0,this.tables=Object.values(this.partitionsMap).map((e=>e.tables)).flat(),this.partitionsConfigCache=new Map,this.partitionedTables=this.tables.filter((e=>e.doesHavePartitionByField(this.type))),this.hasPartitionedTables=0!==this.partitionedTables.length,this.computeDatabaseName=r()(this.computeDatabaseName.bind(this)),this.computePartitionName=r()(this.computePartitionName.bind(this))}clearCache(){this.partitionsConfigCache.clear()}getPartition(e,t){const n=this.session&&(null==t?void 0:t.userId)||"",i=this.session&&(null==t?void 0:t.UIN)||"",a=this.computePartitionName(n,e);let r=this.partitionsConfigCache.get(a);return r||(r=this.createPartitionConfig(n,e,i),r&&this.partitionsConfigCache.set(a,r)),r}getCorruptionImpact(){return this.corruptionImpact}computeDatabaseName(e,t){const n=this.partitionNamingStrategy||[],i=Object(c.b)(this.type),a={session:e,table:t};return n.map((e=>a[e]||e)).join(i)}getPatitionsMapKey(e,t){const n=this.partitionStrategies;if(!n||0===n.length)return"default";const i={session:e,table:t};return n.map((e=>i[e]||e)).join("_")}computePartitionName(e,t){const n=this.getPatitionsMapKey(e,t);if(this.hasPartitionedTables){return`${n}_${-1!==this.partitionedTables.findIndex((e=>e.name===t))?t:"index"}`}return n}createPartitionConfig(e,t,n){const i=this.getPatitionsMapKey(e,t);let a=this.partitionsMap[i];const r=this.computePartitionName(e,t);if(this.hasPartitionedTables){if(-1!==this.partitionedTables.findIndex((e=>e.name===t)))a={tables:[...a.tables].filter((e=>e.name===t))};else{const e=this.partitionedTables.map((e=>e.name));a={tables:[...a.tables].filter((t=>!e.includes(t.name)))}}}return new b(this.name,this.type,r,this.session,this.version,this.milestoneVersion,n,a)}validateConfig(e){const t=e.name;return e.type===l.a.SQLite&&void 0===e.corruptionImpact?[new d.s(t),e]:[null,e]}}const v=Object(s.define)("database-config-manager")},wH4e:function(e,t,n){"use strict";var i=n("UK4g");n.d(t,"GET_ALL_RANGE",(function(){return i.d}));var a=n("YEoC");n.d(t,"AdapterType",(function(){return a.a})),n.d(t,"CorruptionImpact",(function(){return a.b})),n.d(t,"CursorDirection",(function(){return a.c})),n.d(t,"RunMode",(function(){return a.f})),n.d(t,"TransactionMode",(function(){return a.g})),n.d(t,"ValidDataType",(function(){return a.h}));var r=n("DI/x");n.d(t,"DBError",(function(){return r.e})),n.d(t,"INVALID_QUERY_PARAMS_ERROR_CODE",(function(){return r.m})),n.d(t,"MISSING_PARTITION_KEY_ERROR_CODE",(function(){return r.q}));n("PmZf");var s=n("bSii");n.d(t,"firstOrArray",(function(){return s.a}));n("ibl3"),n("xI/L"),n("ohhZ"),n("4W2c"),n("YZti"),n("kFM4")},wudS:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return d}));var i=n("ZcVI");const a="user_ids",r=`sh_${a}`;function s(){const e=globalThis.localStorage.getItem(r);let t=[];try{e&&(t=JSON.parse(e))}catch(n){}return t}function o(){if(null!==globalThis.localStorage.getItem(r))return;const e=function(){let e=new Set;for(let t in localStorage)for(let n of[i.i,i.h,i.q])if(t&&t.startsWith(n+"_")){let i=t.substring(n.length+1,t.length);if(i&&!isNaN(+i)){e.add(i);break}}return 0==e.size?[]:Array.from(e)}();globalThis.localStorage.setItem(r,JSON.stringify(e))}function l(e){let t=s(),n=t.indexOf(e);return-1===n&&(t.push(e),n=t.length-1,globalThis.localStorage.setItem(r,JSON.stringify(t))),n}function d(e){const t=globalThis.localStorage.getItem(r);if(null===t)return!1;return-1!==JSON.parse(t).indexOf(e)}},x9oK:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return C})),n.d(t,"c",(function(){return w}));var i,a=n("8/YW"),r=n("jDHv"),s=n("AH6j"),o=n("Mgpg"),l=n("Uzj0"),d=n("YEoC"),c=n("DI/x"),u=n("PmZf"),p=n("YZti"),m=n("teaq"),h=n("Abbu"),y=n("LzQZ"),g=n("X2RP"),f=n("6Cx8");let b=Object(a.h)()(i=Reflect.metadata("design:type",Function)(i=Reflect.metadata("design:paramtypes",[void 0===m.c?Object:m.c,String,void 0===y.a?Object:y.a,"undefined"==typeof T?Object:T,void 0===g.a?Object:g.a,void 0===f.TransactionExecutor?Object:f.TransactionExecutor,"undefined"==typeof DatabaseAdapterOptions?Object:DatabaseAdapterOptions])(i=class extends s.b{constructor(e,t,n,i,a,s,l){super(),this.partition=e,this.fullName=t,this.transactionManager=n,this.instance=i,this.queryExecutor=a,this.transactionExecutor=s,this.options=l,this.queryExecutorMap=void 0,this.active=!0,this.logger=void 0,this.removeListeners=()=>{},this.isCloseDBQueryContainer=null,this.isDeleteDBQueryContainer=null,this.queryExecutorMap={[d.e.Clear]:a.clear.bind(a),[d.e.Get]:a.get.bind(a),[d.e.GetAndUpdate]:a.getAndUpdate.bind(a),[d.e.GetMulti]:a.getMulti.bind(a),[d.e.GetMultiIfExists]:a.getMultiIfExists.bind(a),[d.e.GetAll]:a.getAll.bind(a),[d.e.GetAllKey]:a.getAllKey.bind(a),[d.e.Insert]:a.insert.bind(a),[d.e.InsertMulti]:a.insertMulti.bind(a),[d.e.Update]:a.update.bind(a),[d.e.UpdateMulti]:a.updateMulti.bind(a),[d.e.Delete]:a.delete.bind(a),[d.e.DeleteMulti]:a.deleteMulti.bind(a),[d.e.FindAndDelete]:a.findAndDelete.bind(a),[d.e.Count]:a.count.bind(a)};const c=r.ModuleContainer.resolve(o.ZLoggerFactory);this.logger=c.createZLogger("db",["adapter"]),this.registerListeners()}registerListeners(){const e=e=>{this.dispatchEvent(e)},t=[];t.push(this.instance.addEventListener(u.b.SuccessOpenDB,e)),t.push(this.instance.addEventListener(u.b.LongOpenDB,e)),t.push(this.instance.addEventListener(u.b.SchemaMigratedAbnormally,e)),t.push(this.queryExecutor.addEventListener(u.b.Warning,e)),this.removeListeners=()=>t.forEach((e=>e()))}onDispose(){this.removeListeners()}get type(){return this.partition.type}getFullName(){return this.fullName}execute(e){if(this.active||h.a.isCloseDBQuery(e)||h.a.isDeleteDBQuery(e)){if(e.meta.step=11,h.a.isBeginTransaction(e))this.transactionExecutor.beginTransaction(e);else if(!h.a.isCommitTransaction(e))return h.a.isCloseDBQuery(e)?(null===this.isCloseDBQueryContainer&&(this.isCloseDBQueryContainer=new l.b.Container,this.closeThisDatabase(e.params).then((()=>this.isCloseDBQueryContainer.resolve())).catch((e=>this.isCloseDBQueryContainer.reject(e)))),void this.isCloseDBQueryContainer.promise.then(e.deferrer.resolve).catch(e.deferrer.reject)):h.a.isDeleteDBQuery(e)?(null===this.isDeleteDBQueryContainer&&(this.isDeleteDBQueryContainer=new l.b.Container,this.deleteThisDatabase(e.params).then((()=>this.isDeleteDBQueryContainer.resolve())).catch((e=>this.isDeleteDBQueryContainer.reject(e)))),void this.isDeleteDBQueryContainer.promise.then(e.deferrer.resolve).catch(e.deferrer.reject)):void(h.a.isCloseAllDBsQuery(e)||h.a.isDeleteAllDBsQuery(e)?this.logger.zsymb(21,"9y_QDW",["Unhandled query type: {}","ae-JbK"],e.type):this.executeByQueryExecutor(e))}else e.deferrer.reject(new c.c("Connection has already been closed"))}async closeThisDatabase(e){this.logger.zsymb(3,"I-HRS3",["Close db: {}","o1FKWo"],this.getFullName()),this.active=!1}async deleteThisDatabase(e){this.logger.zsymb(3,"oBSRzB",["Delete db: {}","ceqdwc"],this.getFullName()),this.active=!1}executeByQueryExecutor(e){e.timing.handled=Date.now();const t=t=>{const n={adapter:this.partition.type,database:e.database,table:e.table,trans:e.transaction};this.logger.zsymb(18,"0YSSU4",(()=>[p.c.getTypeName(e.type),{logInfo:n,error:t}])),e.deferrer.reject(t)};try{if(e.transaction){const t=this.transactionManager.get(e.transaction),n=performance.now();t.execute((()=>this.queryExecutorMap[e.type](e))).then((t=>{const i=performance.now()-n;this.checkTimeConsumingQuery(e,i),e.deferrer.resolve(t)})).catch(e.deferrer.reject)}else{const t=performance.now();this.queryExecutorMap[e.type](e).then((n=>{const i=performance.now()-t;this.checkTimeConsumingQuery(e,i),e.deferrer.resolve(n)})).catch(e.deferrer.reject)}}catch(n){t(n)}}checkTimeConsumingQuery(e,t){if(t>=5e3){const n={adapter:this.partition.type,database:e.database,table:e.table,trans:e.transaction,type:p.c.getTypeName(e.type)};this.logger.zsymb(18,"rxu6v1","Time consuming query:",n,"- Total time: ",t),this.dispatchEvent(new u.i(n,t))}}})||i)||i)||i;const I=`database-adapter-${d.a.IDB}`,v=`database-adapter-${d.a.SQLite}`,C=Object(r.define)(I),w=Object(r.define)(v)},"xI/L":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var i=n("UK4g"),a=n("YEoC");const r={const:e=>e,byUser:()=>"session",byTable:()=>"table"};function s(e){switch(e){case a.a.SQLite:return i.m;case a.a.IDB:return i.e;default:return""}}},xM06:function(e,t,n){"use strict";n.d(t,"A",(function(){return i})),n.d(t,"i",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"k",(function(){return s})),n.d(t,"j",(function(){return o})),n.d(t,"r",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"l",(function(){return c})),n.d(t,"n",(function(){return u})),n.d(t,"f",(function(){return p})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return h})),n.d(t,"a",(function(){return y})),n.d(t,"B",(function(){return g})),n.d(t,"x",(function(){return f})),n.d(t,"m",(function(){return b})),n.d(t,"s",(function(){return I})),n.d(t,"w",(function(){return v})),n.d(t,"u",(function(){return C})),n.d(t,"t",(function(){return w})),n.d(t,"v",(function(){return T})),n.d(t,"o",(function(){return S})),n.d(t,"p",(function(){return _})),n.d(t,"e",(function(){return M})),n.d(t,"y",(function(){return N})),n.d(t,"b",(function(){return D})),n.d(t,"q",(function(){return A})),n.d(t,"z",(function(){return E}));const i="SQL_STATEMENT",a="DAL_UTILITY",r="BACK_UP",s="DB_MIGRATION",o="DB_CORRUPTION",l="NEED-SCHEMA-MIGRATION",d="DAL_UTILITY/CLOSE_DB",c="DAL_UTILITY/DELETE_DB",u="DAL_UTILITY/GET_PARTITION_KEYS",p="DAL_UTILITY/CLEAR_SESSIONAL_POOLS_UTILITY_TYPE_ID",m="DAL_UTILITY/CLEAR_ALL_POOLS_UTILITY_TYPE_ID",h="BACK_UP_UTILITY/CREATE_BACK_UP_TYPE_ID",y="BACK_UP_UTILITY/ABORT_CREATE_BACK_UP_TYPE_ID",g="DB_MIGRATION/START",f="DB_MIGRATION/SEND_PROGRESS",b="DB_MIGRATION/FINISH",I="DB_MIGRATION/PAUSE",v="DB_MIGRATION/RESUME",C="DB_MIGRATION/QOS",w="DB_MIGRATION/PROMOTE",T="DB_MIGRATION/RESET",S="DB_MIGRATION/GET_PROGRESS",_="DB_MIGRATION/INIT_STATE",M="DB_MIGRATION/CLEAR_INFO_DB_SIZE_CACHE",N="SIGNAL_CORRUPTION",D="ANALYZE_CORRUPTION";const A="lst_bic",E=["SQLITE_CORRUPT","SQLITE_NOTADB"]},"xS/Y":function(e,t,n){"use strict";var i=n("VTBJ"),a=n("YEoC"),r=n("xI/L"),s=n("teaq"),o=n("C9Dv");const l=new s.d({tableName:"ref",name:"Ref",fields:{msgId:{name:"msgId",type:a.h.string},convId:{name:"convId",type:a.h.string},uid:{name:"uid",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"msgId"}],unique:!0},uid_msgId:{name:"uid_msgId",fields:[{type:"raw",field:"uid"},{type:"raw",field:"msgId"}],unique:!0},convId:{name:"convId",fields:[{type:"raw",field:"convId"}],unique:!1},uid:{name:"uid",fields:[{type:"raw",field:"uid"}],unique:!1}}}),d=new s.d({tableName:"res",name:"Res",fields:{uid:{name:"uid",type:a.h.string},size:{name:"size",type:a.h.integer},type:{name:"type",type:a.h.integer},atime:{name:"atime",type:a.h.integer},params:{name:"params",type:a.h.string}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"uid"}],unique:!0}}}),c=new s.d({tableName:"SyncDownload",name:"SyncDownload",fields:{fromId:{name:"fromId",type:a.h.string},convId:{name:"convId",type:a.h.string},actionId:{name:"actionId",type:a.h.string,nullable:!0},clientMsgId:{name:"clientMsgId",type:a.h.integer},globalMsgId:{name:"globalMsgId",type:a.h.string,nullable:!0},platform:{name:"platform",type:a.h.integer},deviceId:{name:"deviceId",type:a.h.string},actionSource:{name:"actionSource",type:a.h.integer},sendDttm:{name:"sendDttm",type:a.h.integer},status:{name:"status",type:a.h.integer},sendDate:{name:"sendDate",type:a.h.integer},submited:{name:"submited",type:a.h.boolean},mediaType:{name:"mediaType",type:a.h.string,nullable:!0},metaData:{name:"metaData",type:a.h.json,nullable:!0},errorName:{name:"errorName",type:a.h.string,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"convId"},{type:"raw",field:"fromId"},{type:"raw",field:"clientMsgId"}],unique:!0},sendDate_status:{name:"sendDate_status",fields:[{type:"raw",field:"sendDate"},{type:"raw",field:"status"}],unique:!1},actionSource_status_clientMsgId:{name:"actionSource_status_clientMsgId",fields:[{type:"raw",field:"actionSource"},{type:"raw",field:"status"},{type:"raw",field:"clientMsgId"}],unique:!1}}});c.setAdapterSpecificConfigs(a.a.IDB,{migrations:{2:{version:2,scripts:[{type:"create-table"}]},3:{version:3,scripts:[{type:"add-column",params:{columns:["errorName"]}}]}}});const u=new s.d({tableName:"meta",name:"Meta",fields:{id:{name:"id",type:a.h.string},expiredFlag:{name:"expiredFlag",type:a.h.integer,nullable:!0}},indices:{primary:{name:"primary",fields:[{type:"raw",field:"id"}],unique:!0}}});u.setAdapterSpecificConfigs(a.a.IDB,{migrations:{3:{version:3,scripts:[{type:"create-table"}]}}});const p={Ref:l,Res:d,SyncDownload:c,Meta:u},m={name:"Res",session:!0},h={partitionNamingStrategy:[r.a.byUser(),r.a.const("Res")],partitionsMap:Object(o.a)(p)},y={partitionNamingStrategy:[r.a.const("zres"),r.a.byUser()],partitionsMap:Object(o.a)(p)},g=Object(i.a)(Object(i.a)(Object(i.a)({},m),h),{},{version:1,milestoneVersion:1,type:a.a.SQLite,corruptionImpact:a.b.IMPACT_FULL}),f=Object(i.a)(Object(i.a)(Object(i.a)({},m),y),{},{version:3,milestoneVersion:1,type:a.a.IDB});let b=null,I=null;t.a={baseConfig:m,schema:p,get useSqlite(){return null===b&&(b=new s.a(g)),b},get useIdb(){return null===I&&(I=new s.a(f)),I}}},yi2h:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("VTBJ"),a=n("wH4e");const r=(e,t)=>Object(i.a)(Object(i.a)({},e),{},{type:a.ValidDataType.blob,jsBinaryType:t})}}]);
//# sourceMappingURL=../sourcemaps/lazy/default-login-render-shared-worker-znotification.00d3487c319de8744739.js.map